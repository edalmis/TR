var Dn=Object.defineProperty;var bn=(s,a,i)=>a in s?Dn(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i;var K=(s,a,i)=>(bn(s,typeof a!="symbol"?a+"":a,i),i);import{p as In,m as Nn,w as kn,I as Rn,f as Mn}from"./store.7f25bae6.js";import"./paths.0e6369ab.js";const Nr=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ln(s){if(s.__esModule)return s;var a=s.default;if(typeof a=="function"){var i=function c(){return this instanceof c?Reflect.construct(a,arguments,this.constructor):a.apply(this,arguments)};i.prototype=a.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(s).forEach(function(c){var h=Object.getOwnPropertyDescriptor(s,c);Object.defineProperty(i,c,h.get?h:{enumerable:!0,get:function(){return s[c]}})}),i}var on={exports:{}};(function(s,a){(function(i,c){c(a)})(G,function(i){var c=function(t,e){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},c(t,e)};function h(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");c(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function d(t,e,n,r){var o=arguments.length,f=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(t,e,n,r);else for(var y=t.length-1;y>=0;y--)(u=t[y])&&(f=(o<3?u(f):o>3?u(e,n,f):u(e,n))||f);return o>3&&f&&Object.defineProperty(e,n,f),f}function $(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,f;r<o;r++)(f||!(r in e))&&(f||(f=Array.prototype.slice.call(e,0,r)),f[r]=e[r]);return t.concat(f||Array.prototype.slice.call(e))}var _=255,E=213;i.OPERATION=void 0,function(t){t[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR"}(i.OPERATION||(i.OPERATION={}));var A=function(){function t(e,n,r){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(n,r)}return t.prototype.setParent=function(e,n,r){var o=this;if(this.indexes||(this.indexes=this.ref instanceof q?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=r,!!n)if(this.root=n,this.ref instanceof q){var f=this.ref._definition;for(var u in f.schema){var y=this.ref[u];if(y&&y.$changes){var T=f.indexes[u];y.$changes.setParent(this.ref,n,T)}}}else typeof this.ref=="object"&&this.ref.forEach(function(O,p){if(O instanceof q){var S=O.$changes,g=o.ref.$changes.indexes[p];S.setParent(o.ref,o.root,g)}})},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(e,n){n===void 0&&(n=i.OPERATION.ADD);var r=typeof e=="number"?e:this.indexes[e];this.assertValidIndex(r,e);var o=this.changes.get(r);(!o||o.op===i.OPERATION.DELETE||o.op===i.OPERATION.TOUCH)&&this.changes.set(r,{op:o&&o.op===i.OPERATION.DELETE?i.OPERATION.DELETE_AND_ADD:n,index:r}),this.allChanges.add(r),this.changed=!0,this.touchParents()},t.prototype.touch=function(e){var n=typeof e=="number"?e:this.indexes[e];this.assertValidIndex(n,e),this.changes.has(n)||this.changes.set(n,{op:i.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition){var n=this.ref._definition;return n.schema[n.fieldsByIndex[e]]}else{var n=this.parent._definition,r=n.schema[n.fieldsByIndex[this.parentIndex]];return Object.values(r)[0]}},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(e){var n=typeof e=="number"?e:this.indexes[e];if(n===void 0){console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(e," (").concat(n,")"));return}var r=this.getValue(n);this.changes.set(n,{op:i.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],r&&r.$changes&&(r.$changes.parent=void 0),this.changed=!0,this.touchParents()},t.prototype.discard=function(e,n){var r=this;e===void 0&&(e=!1),n===void 0&&(n=!1),this.ref instanceof q||this.changes.forEach(function(o){if(o.op===i.OPERATION.DELETE){var f=r.ref.getIndex(o.index);delete r.indexes[f]}}),this.changes.clear(),this.changed=e,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach(function(n){var r=e.getValue(n.index);r&&r.$changes&&r.$changes.discardAll()}),this.discard()},t.prototype.cache=function(e,n){this.caches[e]=n},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,n){if(e===void 0)throw new Error('ChangeTree: missing index for field "'.concat(n,'"'))},t}();function m(t,e,n,r){return t[e]||(t[e]=[]),t[e].push(n),r==null||r.forEach(function(o,f){return n(o,f)}),function(){return N(t[e],t[e].indexOf(n))}}function C(t){var e=this,n=typeof this.$changes.getType()!="string";this.$items.forEach(function(r,o){t.push({refId:e.$changes.refId,op:i.OPERATION.DELETE,field:o,value:void 0,previousValue:r}),n&&e.$changes.root.removeRef(r.$changes.refId)})}function N(t,e){if(e===-1||e>=t.length)return!1;for(var n=t.length-1,r=e;r<n;r++)t[r]=t[r+1];return t.length=n,!0}var J=function(t,e){var n=t.toString(),r=e.toString();return n<r?-1:n>r?1:0};function W(t){return t.$proxy=!0,t=new Proxy(t,{get:function(e,n){return typeof n!="symbol"&&!isNaN(n)?e.at(n):e[n]},set:function(e,n,r){if(typeof n!="symbol"&&!isNaN(n)){var o=Array.from(e.$items.keys()),f=parseInt(o[n]||n);r==null?e.deleteAt(f):e.setAt(f,r)}else e[n]=r;return!0},deleteProperty:function(e,n){return typeof n=="number"?e.deleteAt(n):delete e[n],!0}}),t}var M=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.prototype.onAdd=function(e,n){return n===void 0&&(n=!0),m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,e,n?this.$items:void 0)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.is=function(e){return Array.isArray(e)||e.array!==void 0},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){e===0?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o;return n.forEach(function(f){o=e.$refId++,e.setAt(o,f)}),o},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(e!==void 0){this.$changes.delete(e),this.$indexes.delete(e);var n=this.$items.get(e);return this.$items.delete(e),n}},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.setAt=function(e,n){var r,o;if(n==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.$items.get(e)!==n){n.$changes!==void 0&&n.$changes.setParent(this,this.$changes.root,e);var f=(o=(r=this.$changes.indexes[e])===null||r===void 0?void 0:r.op)!==null&&o!==void 0?o:i.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,n),this.$changes.change(e,f)}},t.prototype.deleteAt=function(e){var n=Array.from(this.$items.keys())[e];return n===void 0?!1:this.$deleteAt(n)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&C.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new(t.bind.apply(t,$([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n),!1)))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,n=Array.from(this.$items.keys()),r=Array.from(this.$items.values()).reverse();return r.forEach(function(o,f){e.setAt(n[f],o)}),this},t.prototype.shift=function(){var e=Array.from(this.$items.keys()),n=e.shift();if(n!==void 0){var r=this.$items.get(n);return this.$deleteAt(n),r}},t.prototype.slice=function(e,n){var r=new t;return r.push.apply(r,Array.from(this.$items.values()).slice(e,n)),r},t.prototype.sort=function(e){var n=this;e===void 0&&(e=J);var r=Array.from(this.$items.keys()),o=Array.from(this.$items.values()).sort(e);return o.forEach(function(f,u){n.setAt(r[u],f)}),this},t.prototype.splice=function(e,n){n===void 0&&(n=this.length-e);for(var r=Array.from(this.$items.keys()),o=[],f=e;f<e+n;f++)o.push(this.$items.get(r[f])),this.$deleteAt(r[f]);return o},t.prototype.unshift=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=this.length,f=n.length,u=Array.from(this.$items.values());return n.forEach(function(y,T){e.setAt(T,y)}),u.forEach(function(y,T){e.setAt(f+T,y)}),o+f},t.prototype.indexOf=function(e,n){return Array.from(this.$items.values()).indexOf(e,n)},t.prototype.lastIndexOf=function(e,n){return n===void 0&&(n=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,n)},t.prototype.every=function(e,n){return Array.from(this.$items.values()).every(e,n)},t.prototype.some=function(e,n){return Array.from(this.$items.values()).some(e,n)},t.prototype.forEach=function(e,n){Array.from(this.$items.values()).forEach(e,n)},t.prototype.map=function(e,n){return Array.from(this.$items.values()).map(e,n)},t.prototype.filter=function(e,n){return Array.from(this.$items.values()).filter(e,n)},t.prototype.reduce=function(e,n){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},t.prototype.reduceRight=function(e,n){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},t.prototype.find=function(e,n){return Array.from(this.$items.values()).find(e,n)},t.prototype.findIndex=function(e,n){return Array.from(this.$items.values()).findIndex(e,n)},t.prototype.fill=function(e,n,r){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,n,r){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,n){return Array.from(this.$items.values()).includes(e,n)},t.prototype.flatMap=function(e,n){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.findLast=function(){var e=Array.from(this.$items.values());return e.findLast.apply(e,arguments)},t.prototype.findLastIndex=function(){var e=Array.from(this.$items.values());return e.findLastIndex.apply(e,arguments)},t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map(function(e){return typeof e.toJSON=="function"?e.toJSON():e})},t.prototype.clone=function(e){var n;return e?n=new(t.bind.apply(t,$([void 0],Array.from(this.$items.values()),!1))):n=new(t.bind.apply(t,$([void 0],this.map(function(r){return r.$changes?r.clone():r}),!1))),n},t}();function Ie(t){return t.$proxy=!0,t=new Proxy(t,{get:function(e,n){return typeof n!="symbol"&&typeof e[n]>"u"?e.get(n):e[n]},set:function(e,n,r){return typeof n!="symbol"&&n.indexOf("$")===-1&&n!=="onAdd"&&n!=="onRemove"&&n!=="onChange"?e.set(n,r):e[n]=r,!0},deleteProperty:function(e,n){return e.delete(n),!0}}),t}var B=function(){function t(e){var n=this;if(this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map||e instanceof t)e.forEach(function(o,f){return n.set(f,o)});else for(var r in e)this.set(r,e[r])}return t.prototype.onAdd=function(e,n){return n===void 0&&(n=!0),m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,e,n?this.$items:void 0)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.is=function(e){return e.map!==void 0},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.set=function(e,n){if(n==null)throw new Error("MapSchema#set('".concat(e,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(e,"'."));e=e.toString();var r=typeof this.$changes.indexes[e]<"u",o=r?this.$changes.indexes[e]:this.$refId++,f=r?i.OPERATION.REPLACE:i.OPERATION.ADD,u=n.$changes!==void 0;if(u&&n.$changes.setParent(this,this.$changes.root,o),!r)this.$changes.indexes[e]=o,this.$indexes.set(o,e);else{if(!u&&this.$items.get(e)===n)return;u&&this.$items.get(e)!==n&&(f=i.OPERATION.ADD)}return this.$items.set(e,n),this.$changes.change(e,f),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&C.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach(function(n,r){e[r]=typeof n.toJSON=="function"?n.toJSON():n}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r,o){r.$changes?n.set(o,r.clone()):n.set(o,r)})),n},t}(),he={};function Y(t,e){he[t]=e}function ae(t){return he[t]}var Re=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(e){var n=new t;return n.schema=Object.assign({},e&&e.schema||{}),n.indexes=Object.assign({},e&&e.indexes||{}),n.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),n.descriptors=Object.assign({},e&&e.descriptors||{}),n.deprecated=Object.assign({},e&&e.deprecated||{}),n},t.prototype.addField=function(e,n){var r=this.getNextFieldIndex();this.fieldsByIndex[r]=e,this.indexes[e]=r,this.schema[e]=Array.isArray(n)?{array:n[0]}:n},t.prototype.hasField=function(e){return this.indexes[e]!==void 0},t.prototype.addFilter=function(e,n){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=n,this.indexesWithFilters.push(this.indexes[e]),!0},t.prototype.addChildrenFilter=function(e,n){var r=this.indexes[e],o=this.schema[e];if(ae(Object.keys(o)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[r]=n,!0;console.warn("@filterChildren: field '".concat(e,"' can't have children. Ignoring filter."))},t.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();function Tt(t){return t._context&&t._context.useFilters}var _e=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(e){return this.schemas.has(e)},t.prototype.get=function(e){return this.types[e]},t.prototype.add=function(e,n){n===void 0&&(n=this.schemas.size),e._definition=Re.create(e._definition),e._typeid=n,this.types[n]=e,this.schemas.set(e,n)},t.create=function(e){return e===void 0&&(e={}),function(n){return e.context||(e.context=new t),z(n,e)}},t}(),Xe=new _e;function z(t,e){return e===void 0&&(e={}),function(n,r){var o=e.context||Xe,f=n.constructor;if(f._context=o,!t)throw new Error("".concat(f.name,': @type() reference provided for "').concat(r,`" is undefined. Make sure you don't have any circular dependencies.`));o.has(f)||o.add(f);var u=f._definition;if(u.addField(r,t),u.descriptors[r]){if(u.deprecated[r])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(r,"' definition on '").concat(f.name,`'.
Check @type() annotation`))}catch(g){var y=g.stack.split(`
`)[4].trim();throw new Error("".concat(g.message," ").concat(y))}}var T=M.is(t),O=!T&&B.is(t);if(typeof t!="string"&&!q.is(t)){var p=Object.values(t)[0];typeof p!="string"&&!o.has(p)&&o.add(p)}if(e.manual){u.descriptors[r]={enumerable:!0,configurable:!0,writable:!0};return}var S="_".concat(r);u.descriptors[S]={enumerable:!1,configurable:!1,writable:!0},u.descriptors[r]={get:function(){return this[S]},set:function(g){g!==this[S]&&(g!=null?(T&&!(g instanceof M)&&(g=new(M.bind.apply(M,$([void 0],g,!1)))),O&&!(g instanceof B)&&(g=new B(g)),g.$proxy===void 0&&(O?g=Ie(g):T&&(g=W(g))),this.$changes.change(r),g.$changes&&g.$changes.setParent(this,this.$changes.root,this._definition.indexes[r])):this[S]&&this.$changes.delete(r),this[S]=g)},enumerable:!0,configurable:!0}}}function St(t){return function(e,n){var r=e.constructor,o=r._definition;o.addFilter(n,t)&&(r._context.useFilters=!0)}}function Pt(t){return function(e,n){var r=e.constructor,o=r._definition;o.addChildrenFilter(n,t)&&(r._context.useFilters=!0)}}function Ct(t){return t===void 0&&(t=!0),function(e,n){var r=e.constructor,o=r._definition;o.deprecated[n]=!0,t&&(o.descriptors[n]={get:function(){throw new Error("".concat(n," is deprecated."))},set:function(f){},enumerable:!1,configurable:!0})}}function Dt(t,e,n){n===void 0&&(n={}),n.context||(n.context=t._context||n.context||Xe);for(var r in e)z(e[r],n)(t.prototype,r);return t}function bt(t){for(var e=0,n=0,r=0,o=t.length;r<o;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function Ve(t,e,n){for(var r=0,o=0,f=n.length;o<f;o++)r=n.charCodeAt(o),r<128?t[e++]=r:r<2048?(t[e++]=192|r>>6,t[e++]=128|r&63):r<55296||r>=57344?(t[e++]=224|r>>12,t[e++]=128|r>>6&63,t[e++]=128|r&63):(o++,r=65536+((r&1023)<<10|n.charCodeAt(o)&1023),t[e++]=240|r>>18,t[e++]=128|r>>12&63,t[e++]=128|r>>6&63,t[e++]=128|r&63)}function Qe(t,e){t.push(e&255)}function j(t,e){t.push(e&255)}function Ze(t,e){t.push(e&255),t.push(e>>8&255)}function Te(t,e){t.push(e&255),t.push(e>>8&255)}function ue(t,e){t.push(e&255),t.push(e>>8&255),t.push(e>>16&255),t.push(e>>24&255)}function te(t,e){var n=e>>24,r=e>>16,o=e>>8,f=e;t.push(f&255),t.push(o&255),t.push(r&255),t.push(n&255)}function et(t,e){var n=Math.floor(e/Math.pow(2,32)),r=e>>>0;te(t,r),te(t,n)}function tt(t,e){var n=e/Math.pow(2,32)>>0,r=e>>>0;te(t,r),te(t,n)}function Nt(t,e){nt(t,e)}function kt(t,e){Se(t,e)}var de=new Int32Array(2),Mt=new Float32Array(de.buffer),Lt=new Float64Array(de.buffer);function nt(t,e){Mt[0]=e,ue(t,de[0])}function Se(t,e){Lt[0]=e,ue(t,de[0]),ue(t,de[1])}function jt(t,e){return j(t,e?1:0)}function Ae(t,e){e||(e="");var n=bt(e),r=0;if(n<32)t.push(n|160),r=1;else if(n<256)t.push(217),j(t,n),r=2;else if(n<65536)t.push(218),Te(t,n),r=3;else if(n<4294967296)t.push(219),te(t,n),r=5;else throw new Error("String too long");return Ve(t,t.length,e),r+n}function U(t,e){if(isNaN(e))return U(t,0);if(isFinite(e)){if(e!==(e|0))return t.push(203),Se(t,e),9}else return U(t,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER);return e>=0?e<128?(j(t,e),1):e<256?(t.push(204),j(t,e),2):e<65536?(t.push(205),Te(t,e),3):e<4294967296?(t.push(206),te(t,e),5):(t.push(207),tt(t,e),9):e>=-32?(t.push(224|e+32),1):e>=-128?(t.push(208),Qe(t,e),2):e>=-32768?(t.push(209),Ze(t,e),3):e>=-2147483648?(t.push(210),ue(t,e),5):(t.push(211),et(t,e),9)}var Pe=Object.freeze({__proto__:null,utf8Write:Ve,int8:Qe,uint8:j,int16:Ze,uint16:Te,int32:ue,uint32:te,int64:et,uint64:tt,float32:Nt,float64:kt,writeFloat32:nt,writeFloat64:Se,boolean:jt,string:Ae,number:U});function Ft(t,e,n){for(var r="",o=0,f=e,u=e+n;f<u;f++){var y=t[f];if(!(y&128)){r+=String.fromCharCode(y);continue}if((y&224)===192){r+=String.fromCharCode((y&31)<<6|t[++f]&63);continue}if((y&240)===224){r+=String.fromCharCode((y&15)<<12|(t[++f]&63)<<6|(t[++f]&63)<<0);continue}if((y&248)===240){o=(y&7)<<18|(t[++f]&63)<<12|(t[++f]&63)<<6|(t[++f]&63)<<0,o>=65536?(o-=65536,r+=String.fromCharCode((o>>>10)+55296,(o&1023)+56320)):r+=String.fromCharCode(o);continue}console.error("Invalid byte "+y.toString(16))}return r}function rt(t,e){return le(t,e)<<24>>24}function le(t,e){return t[e.offset++]}function it(t,e){return Oe(t,e)<<16>>16}function Oe(t,e){return t[e.offset++]|t[e.offset++]<<8}function ne(t,e){return t[e.offset++]|t[e.offset++]<<8|t[e.offset++]<<16|t[e.offset++]<<24}function ce(t,e){return ne(t,e)>>>0}function Ut(t,e){return Ce(t,e)}function zt(t,e){return De(t,e)}function ot(t,e){var n=ce(t,e),r=ne(t,e)*Math.pow(2,32);return r+n}function st(t,e){var n=ce(t,e),r=ce(t,e)*Math.pow(2,32);return r+n}var pe=new Int32Array(2),Bt=new Float32Array(pe.buffer),Ht=new Float64Array(pe.buffer);function Ce(t,e){return pe[0]=ne(t,e),Bt[0]}function De(t,e){return pe[0]=ne(t,e),pe[1]=ne(t,e),Ht[0]}function Jt(t,e){return le(t,e)>0}function at(t,e){var n=t[e.offset++],r;n<192?r=n&31:n===217?r=le(t,e):n===218?r=Oe(t,e):n===219&&(r=ce(t,e));var o=Ft(t,e.offset,r);return e.offset+=r,o}function qt(t,e){var n=t[e.offset];return n<192&&n>160||n===217||n===218||n===219}function re(t,e){var n=t[e.offset++];if(n<128)return n;if(n===202)return Ce(t,e);if(n===203)return De(t,e);if(n===204)return le(t,e);if(n===205)return Oe(t,e);if(n===206)return ce(t,e);if(n===207)return st(t,e);if(n===208)return rt(t,e);if(n===209)return it(t,e);if(n===210)return ne(t,e);if(n===211)return ot(t,e);if(n>223)return(255-n+1)*-1}function Wt(t,e){var n=t[e.offset];return n<128||n>=202&&n<=211}function Kt(t,e){return t[e.offset]<160}function ct(t,e){return t[e.offset-1]===_&&(t[e.offset]<128||t[e.offset]>=202&&t[e.offset]<=211)}var ft=Object.freeze({__proto__:null,int8:rt,uint8:le,int16:it,uint16:Oe,int32:ne,uint32:ce,float32:Ut,float64:zt,int64:ot,uint64:st,readFloat32:Ce,readFloat64:De,boolean:Jt,string:at,stringCheck:qt,number:re,numberCheck:Wt,arrayCheck:Kt,switchStructureCheck:ct}),be=function(){function t(e){var n=this;this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(r){return n.add(r)})}return t.prototype.onAdd=function(e,n){return n===void 0&&(n=!0),m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,e,n?this.$items:void 0)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.is=function(e){return e.collection!==void 0},t.prototype.add=function(e){var n=this.$refId++,r=e.$changes!==void 0;return r&&e.$changes.setParent(this,this.$changes.root,n),this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,e),this.$changes.change(n),n},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var n=this.$items.entries(),r,o;(o=n.next())&&!o.done;)if(e===o.value[1]){r=o.value[0];break}return r===void 0?!1:(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},t.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&C.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some(function(n){return n===e})},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(r,o,f){return e(r,o,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,r){e.push(typeof n.toJSON=="function"?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r){r.$changes?n.add(r.clone()):n.add(r)})),n},t}(),Ne=function(){function t(e){var n=this;this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(r){return n.add(r)})}return t.prototype.onAdd=function(e,n){return n===void 0&&(n=!0),m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,e,n?this.$items:void 0)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.is=function(e){return e.set!==void 0},t.prototype.add=function(e){var n,r;if(this.has(e))return!1;var o=this.$refId++;e.$changes!==void 0&&e.$changes.setParent(this,this.$changes.root,o);var f=(r=(n=this.$changes.indexes[o])===null||n===void 0?void 0:n.op)!==null&&r!==void 0?r:i.OPERATION.ADD;return this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,e),this.$changes.change(o,f),o},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var n=this.$items.entries(),r,o;(o=n.next())&&!o.done;)if(e===o.value[1]){r=o.value[0];break}return r===void 0?!1:(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},t.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&C.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var n=this.$items.values(),r=!1,o;(o=n.next())&&!o.done;)if(e===o.value){r=!0;break}return r},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(r,o,f){return e(r,o,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,r){e.push(typeof n.toJSON=="function"?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r){r.$changes?n.add(r.clone()):n.add(r)})),n},t}(),Gt=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},t.get=function(e){return e.$filterState===void 0&&(e.$filterState=new t),e.$filterState},t}(),Yt=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(e,n,r){r===void 0&&(r=!0),this.refs.set(e,n),r&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},t.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(n){if(!(e.refCounts[n]>0)){var r=e.refs.get(n);if(r instanceof q)for(var o in r._definition.schema)typeof r._definition.schema[o]!="string"&&r[o]&&r[o].$changes&&e.removeRef(r[o].$changes.refId);else{var f=r.$changes.parent._definition,u=f.schema[f.fieldsByIndex[r.$changes.parentIndex]];typeof Object.values(u)[0]=="function"&&Array.from(r.values()).forEach(function(y){return e.removeRef(y.$changes.refId)})}e.refs.delete(n),delete e.refCounts[n]}}),this.deletedRefs.clear()},t}(),ke=function(t){h(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Error);function Xt(t,e,n,r){var o,f=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":o="number",isNaN(t)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(r));break;case"string":o="string",f=!0;break;case"boolean":return}if(typeof t!==o&&(!f||f&&t!==null)){var u="'".concat(JSON.stringify(t),"'").concat(t&&t.constructor&&" (".concat(t.constructor.name,")")||"");throw new ke("a '".concat(o,"' was expected, but ").concat(u," was provided in ").concat(n.constructor.name,"#").concat(r))}}function ht(t,e,n,r){if(!(t instanceof e))throw new ke("a '".concat(e.name,"' was expected, but '").concat(t.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(r))}function Vt(t,e,n,r,o){Xt(n,t,r,o);var f=Pe[t];if(f)f(e,n);else throw new ke("a '".concat(t,"' was expected, but ").concat(n," was provided in ").concat(r.constructor.name,"#").concat(o))}function Qt(t,e,n){return ft[t](e,n)}var q=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Object.defineProperties(this,{$changes:{value:new A(this,void 0,new Yt),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var r=this._definition.descriptors;r&&Object.defineProperties(this,r),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&e._definition.schema!==void 0},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.setDirty=function(e,n){this.$changes.change(e,n)},t.prototype.listen=function(e,n,r){var o=this;return r===void 0&&(r=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[e]||(this.$callbacks[e]=[]),this.$callbacks[e].push(n),r&&this[e]!==void 0&&n(this[e],void 0),function(){return N(o.$callbacks[e],o.$callbacks[e].indexOf(n))}},t.prototype.decode=function(e,n,r){var o;n===void 0&&(n={offset:0}),r===void 0&&(r=this);var f=[],u=this.$changes.root,y=e.length,T=0;for(u.refs.set(T,this);n.offset<y;){var O=e[n.offset++];if(O==_){T=re(e,n);var p=u.refs.get(T);if(!p)throw new Error('"refId" not found: '.concat(T));r=p;continue}var S=r.$changes,g=r._definition!==void 0,w=g?O>>6<<6:O;if(w===i.OPERATION.CLEAR){r.clear(f);continue}var v=g?O%(w||255):re(e,n),x=g?r._definition.fieldsByIndex[v]:"",l=S.getType(v),I=void 0,D=void 0,b=void 0;if(g?D=r["_".concat(x)]:(D=r.getByIndex(v),(w&i.OPERATION.ADD)===i.OPERATION.ADD?(b=r instanceof B?at(e,n):v,r.setIndex(v,b)):b=r.getIndex(v)),(w&i.OPERATION.DELETE)===i.OPERATION.DELETE&&(w!==i.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(v),D&&D.$changes&&u.removeRef(D.$changes.refId),I=null),x===void 0){console.warn("@colyseus/schema: definition mismatch");for(var P={offset:n.offset};n.offset<y&&!(ct(e,n)&&(P.offset=n.offset+1,u.refs.has(re(e,P))));)n.offset++;continue}else if(w!==i.OPERATION.DELETE)if(t.is(l)){var R=re(e,n);if(I=u.refs.get(R),w!==i.OPERATION.REPLACE){var V=this.getSchemaType(e,n,l);I||(I=this.createTypeInstance(V),I.$changes.refId=R,D&&(I.$callbacks=D.$callbacks,D.$changes.refId&&R!==D.$changes.refId&&u.removeRef(D.$changes.refId))),u.addRef(R,I,I!==D)}}else if(typeof l=="string")I=Qt(l,e,n);else{var je=ae(Object.keys(l)[0]),F=re(e,n),k=u.refs.has(F)?D||u.refs.get(F):new je.constructor;if(I=k.clone(!0),I.$changes.refId=F,D&&(I.$callbacks=D.$callbacks,D.$changes.refId&&F!==D.$changes.refId)){u.removeRef(D.$changes.refId);for(var L=D.entries(),ge=void 0;(ge=L.next())&&!ge.done;){var X=(o=ge.value,o[0]),Fe=o[1];f.push({refId:F,op:i.OPERATION.DELETE,field:X,value:void 0,previousValue:Fe})}}u.addRef(F,I,k!==D)}if(I!=null){if(I.$changes&&I.$changes.setParent(S.ref,S.root,v),r instanceof t)r[x]=I;else if(r instanceof B){var X=b;r.$items.set(X,I),r.$changes.allChanges.add(v)}else if(r instanceof M)r.setAt(v,I);else if(r instanceof be){var Q=r.add(I);r.setIndex(v,Q)}else if(r instanceof Ne){var Q=r.add(I);Q!==!1&&r.setIndex(v,Q)}}D!==I&&f.push({refId:T,op:w,field:x,dynamicIndex:b,value:I,previousValue:D})}return this._triggerChanges(f),u.garbageCollectDeletedRefs(),f},t.prototype.encode=function(e,n,r){e===void 0&&(e=!1),n===void 0&&(n=[]),r===void 0&&(r=!1);for(var o=this.$changes,f=new WeakSet,u=[o],y=1,T=0;T<y;T++){var O=u[T],p=O.ref,S=p instanceof t;O.ensureRefId(),f.add(O),O!==o&&(O.changed||e)&&(j(n,_),U(n,O.refId));for(var g=e?Array.from(O.allChanges):Array.from(O.changes.values()),w=0,v=g.length;w<v;w++){var x=e?{op:i.OPERATION.ADD,index:g[w]}:g[w],l=x.index,I=S?p._definition.fieldsByIndex&&p._definition.fieldsByIndex[l]:l,D=n.length;if(x.op!==i.OPERATION.TOUCH)if(S)j(n,l|x.op);else{if(j(n,x.op),x.op===i.OPERATION.CLEAR)continue;U(n,l)}if(!S&&(x.op&i.OPERATION.ADD)==i.OPERATION.ADD&&p instanceof B){var b=O.ref.$indexes.get(l);Ae(n,b)}if(x.op!==i.OPERATION.DELETE){var P=O.getType(l),R=O.getValue(l);if(R&&R.$changes&&!f.has(R.$changes)&&(u.push(R.$changes),R.$changes.ensureRefId(),y++),x.op!==i.OPERATION.TOUCH){if(t.is(P))ht(R,P,p,I),U(n,R.$changes.refId),(x.op&i.OPERATION.ADD)===i.OPERATION.ADD&&this.tryEncodeTypeId(n,P,R.constructor);else if(typeof P=="string")Vt(P,n,R,p,I);else{var V=ae(Object.keys(P)[0]);ht(p["_".concat(I)],V.constructor,p,I),U(n,R.$changes.refId)}r&&O.cache(l,n.slice(D))}}}!e&&!r&&O.discard()}return n},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(e,n){var r,o;n===void 0&&(n=!1);for(var f=this,u=new Set,y=Gt.get(e),T=[this.$changes],O=1,p=[],S=function(w){var v=T[w];if(u.has(v.refId))return"continue";var x=v.ref,l=x instanceof t;j(p,_),U(p,v.refId);var I=y.refIds.has(v),D=n||!I;y.addRefId(v);var b=y.containerIndexes.get(v),P=D?Array.from(v.allChanges):Array.from(v.changes.values());if(!n&&l&&x._definition.indexesWithFilters){var R=x._definition.indexesWithFilters;R.forEach(function(xe){!b.has(xe)&&v.allChanges.has(xe)&&(D?P.push(xe):P.push({op:i.OPERATION.ADD,index:xe}))})}for(var V=0,je=P.length;V<je;V++){var F=D?{op:i.OPERATION.ADD,index:P[V]}:P[V];if(F.op===i.OPERATION.CLEAR){j(p,F.op);continue}var k=F.index;if(F.op===i.OPERATION.DELETE){l?j(p,F.op|k):(j(p,F.op),U(p,k));continue}var L=v.getValue(k),ge=v.getType(k);if(l){var X=x._definition.filters&&x._definition.filters[k];if(X&&!X.call(x,e,L,f)){L&&L.$changes&&u.add(L.$changes.refId);continue}}else{var Fe=v.parent,X=v.getChildrenFilter();if(X&&!X.call(Fe,e,x.$indexes.get(k),L,f)){L&&L.$changes&&u.add(L.$changes.refId);continue}}if(L.$changes&&(T.push(L.$changes),O++),F.op!==i.OPERATION.TOUCH)if(F.op===i.OPERATION.ADD||l)p.push.apply(p,(r=v.caches[k])!==null&&r!==void 0?r:[]),b.add(k);else if(b.has(k))p.push.apply(p,(o=v.caches[k])!==null&&o!==void 0?o:[]);else{if(b.add(k),j(p,i.OPERATION.ADD),U(p,k),x instanceof B){var Q=v.ref.$indexes.get(k);Ae(p,Q)}L.$changes?U(p,L.$changes.refId):Pe[ge](p,L)}else if(L.$changes&&!l){if(j(p,i.OPERATION.ADD),U(p,k),x instanceof B){var Q=v.ref.$indexes.get(k);Ae(p,Q)}U(p,L.$changes.refId)}}},g=0;g<O;g++)S(g);return p},t.prototype.clone=function(){var e,n=new this.constructor,r=this._definition.schema;for(var o in r)typeof this[o]=="object"&&typeof((e=this[o])===null||e===void 0?void 0:e.clone)=="function"?n[o]=this[o].clone():n[o]=this[o];return n},t.prototype.toJSON=function(){var e=this._definition.schema,n=this._definition.deprecated,r={};for(var o in e)!n[o]&&this[o]!==null&&typeof this[o]<"u"&&(r[o]=typeof this[o].toJSON=="function"?this[o].toJSON():this["_".concat(o)]);return r},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,n,r){n._typeid!==r._typeid&&(j(e,E),U(e,r._typeid))},t.prototype.getSchemaType=function(e,n,r){var o;return e[n.offset]===E&&(n.offset++,o=this.constructor._context.get(re(e,n))),o||r},t.prototype.createTypeInstance=function(e){var n=new e;return n.$changes.root=this.$changes.root,n},t.prototype._triggerChanges=function(e){for(var n,r,o,f,u,y,T,O,p,S=new Set,g=this.$changes.root.refs,w=function(x){var l=e[x],I=l.refId,D=g.get(I),b=D.$callbacks;if((l.op&i.OPERATION.DELETE)===i.OPERATION.DELETE&&l.previousValue instanceof t&&((r=(n=l.previousValue.$callbacks)===null||n===void 0?void 0:n[i.OPERATION.DELETE])===null||r===void 0||r.forEach(function(P){return P()})),!b)return"continue";if(D instanceof t){if(!S.has(I))try{(o=b==null?void 0:b[i.OPERATION.REPLACE])===null||o===void 0||o.forEach(function(P){return P()})}catch(P){t.onError(P)}try{b.hasOwnProperty(l.field)&&((f=b[l.field])===null||f===void 0||f.forEach(function(P){return P(l.value,l.previousValue)}))}catch(P){t.onError(P)}}else l.op===i.OPERATION.ADD&&l.previousValue===void 0?(u=b[i.OPERATION.ADD])===null||u===void 0||u.forEach(function(P){var R;return P(l.value,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)}):l.op===i.OPERATION.DELETE?l.previousValue!==void 0&&((y=b[i.OPERATION.DELETE])===null||y===void 0||y.forEach(function(P){var R;return P(l.previousValue,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)})):l.op===i.OPERATION.DELETE_AND_ADD&&(l.previousValue!==void 0&&((T=b[i.OPERATION.DELETE])===null||T===void 0||T.forEach(function(P){var R;return P(l.previousValue,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)})),(O=b[i.OPERATION.ADD])===null||O===void 0||O.forEach(function(P){var R;return P(l.value,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)})),l.value!==l.previousValue&&((p=b[i.OPERATION.REPLACE])===null||p===void 0||p.forEach(function(P){var R;return P(l.value,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)}));S.add(I)},v=0;v<e.length;v++)w(v)},t._definition=Re.create(),t}();function Zt(t){for(var e=[t.$changes],n=1,r={},o=r,f=function(y){var T=e[y];T.changes.forEach(function(O){var p=T.ref,S=O.index,g=p._definition?p._definition.fieldsByIndex[S]:p.$indexes.get(S);o[g]=T.getValue(S)})},u=0;u<n;u++)f(u);return r}var ie={context:new _e},Me=function(t){h(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return d([z("string",ie)],e.prototype,"name",void 0),d([z("string",ie)],e.prototype,"type",void 0),d([z("number",ie)],e.prototype,"referencedType",void 0),e}(q),Le=function(t){h(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.fields=new M,n}return d([z("number",ie)],e.prototype,"id",void 0),d([z([Me],ie)],e.prototype,"fields",void 0),e}(q),en=function(t){h(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.types=new M,n}return e.encode=function(n){var r=n.constructor,o=new e;o.rootType=r._typeid;var f=function(O,p){for(var S in p){var g=new Me;g.name=S;var w=void 0;if(typeof p[S]=="string")w=p[S];else{var v=p[S],x=void 0;q.is(v)?(w="ref",x=p[S]):(w=Object.keys(v)[0],typeof v[w]=="string"?w+=":"+v[w]:x=v[w]),g.referencedType=x?x._typeid:-1}g.type=w,O.fields.push(g)}o.types.push(O)},u=r._context.types;for(var y in u){var T=new Le;T.id=Number(y),f(T,u[y]._definition.schema)}return o.encodeAll()},e.decode=function(n,r){var o=new _e,f=new e;f.decode(n,r);var u=f.types.reduce(function(S,g){var w=function(x){h(l,x);function l(){return x!==null&&x.apply(this,arguments)||this}return l}(q),v=g.id;return S[v]=w,o.add(w,v),S},{});f.types.forEach(function(S){var g=u[S.id];S.fields.forEach(function(w){var v;if(w.referencedType!==void 0){var x=w.type,l=u[w.referencedType];if(!l){var I=w.type.split(":");x=I[0],l=I[1]}x==="ref"?z(l,{context:o})(g.prototype,w.name):z((v={},v[x]=l,v),{context:o})(g.prototype,w.name)}else z(w.type,{context:o})(g.prototype,w.name)})});var y=u[f.rootType],T=new y;for(var O in y._definition.schema){var p=y._definition.schema[O];typeof p!="string"&&(T[O]=typeof p=="function"?new p:new(ae(Object.keys(p)[0])).constructor)}return T},d([z([Le],ie)],e.prototype,"types",void 0),d([z("number",ie)],e.prototype,"rootType",void 0),e}(q);Y("map",{constructor:B}),Y("array",{constructor:M}),Y("set",{constructor:Ne}),Y("collection",{constructor:be}),i.ArraySchema=M,i.CollectionSchema=be,i.Context=_e,i.MapSchema=B,i.Reflection=en,i.ReflectionField=Me,i.ReflectionType=Le,i.Schema=q,i.SchemaDefinition=Re,i.SetSchema=Ne,i.decode=ft,i.defineTypes=Dt,i.deprecated=Ct,i.dumpChanges=Zt,i.encode=Pe,i.filter=St,i.filterChildren=Pt,i.hasFilter=Tt,i.registerType=Y,i.type=z,Object.defineProperty(i,"__esModule",{value:!0})})})(on,on.exports);var oe=on.exports,jn=Object.defineProperty,Fn=Object.getOwnPropertyDescriptor,me=(s,a,i,c)=>{for(var h=c>1?void 0:c?Fn(a,i):a,d=s.length-1,$;d>=0;d--)($=s[d])&&(h=(c?$(a,i,h):$(h))||h);return c&&h&&jn(a,i,h),h};const sn={width:1280,height:720},Be={x:Math.round(sn.width/2),y:Math.round(sn.height/2)},Ke=class an extends oe.Schema{constructor(a){super(),this.side=a,this.y=Be.y,this.initialize()}reset(){this.initialize()}initialize(){const a=an.width/2+an.offset;switch(this.side){case 0:this.x=a;break;case 1:this.x=sn.width-a;break}this.y=Be.y}};Ke.offset=50;Ke.width=40;Ke.height=200;me([oe.type("int32")],Ke.prototype,"x",2);me([oe.type("int32")],Ke.prototype,"y",2);let yt=Ke,dt=class extends oe.Schema{constructor(){super(...arguments),this.x=Be.x,this.y=Be.y}reset(){this.center()}center(){this.x=Be.x,this.y=Be.y}};dt.radius=25;me([oe.type("int32")],dt.prototype,"x",2);me([oe.type("int32")],dt.prototype,"y",2);let Et=class extends oe.Schema{constructor(){super(...arguments),this.left=0,this.right=0}reset(){this.left=0,this.right=0}};me([oe.type("int8")],Et.prototype,"left",2);me([oe.type("int8")],Et.prototype,"right",2);let lt=class extends oe.Schema{constructor(){super(...arguments),this.gameStatus=0,this.scoreboard=new Et,this.leftPaddle=new yt(0),this.rightPaddle=new yt(1),this.ball=new dt}};me([oe.type("int8")],lt.prototype,"gameStatus",2);me([oe.type(Et)],lt.prototype,"scoreboard",2);me([oe.type(yt)],lt.prototype,"leftPaddle",2);me([oe.type(yt)],lt.prototype,"rightPaddle",2);me([oe.type(dt)],lt.prototype,"ball",2);var Un=(s=>(s[s.UP=0]="UP",s[s.DOWN=1]="DOWN",s[s.STOP=2]="STOP",s))(Un||{}),zn={};ArrayBuffer.isView||(ArrayBuffer.isView=s=>s!==null&&typeof s=="object"&&s.buffer instanceof ArrayBuffer);typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var Je={};function gn(s,a){a.headers=s.headers||{},a.statusMessage=s.statusText,a.statusCode=s.status,a.data=s.response}function ye(s,a,i){return new Promise(function(c,h){i=i||{};var d=new XMLHttpRequest,$,_,E,A=i.body,m=i.headers||{};i.timeout&&(d.timeout=i.timeout),d.ontimeout=d.onerror=function(C){C.timeout=C.type=="timeout",h(C)},d.open(s,a.href||a),d.onload=function(){for(E=d.getAllResponseHeaders().trim().split(/[\r\n]+/),gn(d,d);_=E.shift();)_=_.split(": "),d.headers[_.shift().toLowerCase()]=_.join(": ");if(_=d.headers["content-type"],_&&~_.indexOf("application/json"))try{d.data=JSON.parse(d.data,i.reviver)}catch(C){return gn(d,C),h(C)}(d.status>=400?h:c)(d)},typeof FormData<"u"&&A instanceof FormData||A&&typeof A=="object"&&(m["content-type"]="application/json",A=JSON.stringify(A)),d.withCredentials=!!i.withCredentials;for($ in m)d.setRequestHeader($,m[$]);d.send(A)})}var Bn=ye.bind(ye,"GET"),Hn=ye.bind(ye,"POST"),Jn=ye.bind(ye,"PATCH"),qn=ye.bind(ye,"DELETE"),Wn=ye.bind(ye,"PUT");const Kn=Object.freeze(Object.defineProperty({__proto__:null,del:qn,get:Bn,patch:Jn,post:Hn,put:Wn,send:ye},Symbol.toStringTag,{value:"Module"})),Tn=Ln(Kn);var hn={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.ServerError=s.CloseCode=void 0,function(i){i[i.CONSENTED=4e3]="CONSENTED",i[i.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(s.CloseCode||(s.CloseCode={}));class a extends Error{constructor(c,h){super(h),this.name="ServerError",this.code=c}}s.ServerError=a})(hn);var pt={},qe={};Object.defineProperty(qe,"__esModule",{value:!0});qe.decode=qe.encode=void 0;function Ge(s,a){if(this._offset=a,s instanceof ArrayBuffer)this._buffer=s,this._view=new DataView(this._buffer);else if(ArrayBuffer.isView(s))this._buffer=s.buffer,this._view=new DataView(this._buffer,s.byteOffset,s.byteLength);else throw new Error("Invalid argument")}function Gn(s,a,i){for(var c="",h=0,d=a,$=a+i;d<$;d++){var _=s.getUint8(d);if(!(_&128)){c+=String.fromCharCode(_);continue}if((_&224)===192){c+=String.fromCharCode((_&31)<<6|s.getUint8(++d)&63);continue}if((_&240)===224){c+=String.fromCharCode((_&15)<<12|(s.getUint8(++d)&63)<<6|(s.getUint8(++d)&63)<<0);continue}if((_&248)===240){h=(_&7)<<18|(s.getUint8(++d)&63)<<12|(s.getUint8(++d)&63)<<6|(s.getUint8(++d)&63)<<0,h>=65536?(h-=65536,c+=String.fromCharCode((h>>>10)+55296,(h&1023)+56320)):c+=String.fromCharCode(h);continue}throw new Error("Invalid byte "+_.toString(16))}return c}Ge.prototype._array=function(s){for(var a=new Array(s),i=0;i<s;i++)a[i]=this._parse();return a};Ge.prototype._map=function(s){for(var a="",i={},c=0;c<s;c++)a=this._parse(),i[a]=this._parse();return i};Ge.prototype._str=function(s){var a=Gn(this._view,this._offset,s);return this._offset+=s,a};Ge.prototype._bin=function(s){var a=this._buffer.slice(this._offset,this._offset+s);return this._offset+=s,a};Ge.prototype._parse=function(){var s=this._view.getUint8(this._offset++),a,i=0,c=0,h=0,d=0;if(s<192)return s<128?s:s<144?this._map(s&15):s<160?this._array(s&15):this._str(s&31);if(s>223)return(255-s+1)*-1;switch(s){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:if(i=this._view.getUint8(this._offset),c=this._view.getInt8(this._offset+1),this._offset+=2,c===-1){var $=this._view.getUint32(this._offset);return h=this._view.getInt32(this._offset+4),d=this._view.getUint32(this._offset+8),this._offset+=12,new Date((h*4294967296+d)*1e3+$/1e6)}return[c,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),c=this._view.getInt8(this._offset+2),this._offset+=3,[c,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),c=this._view.getInt8(this._offset+4),this._offset+=5,[c,this._bin(i)];case 202:return a=this._view.getFloat32(this._offset),this._offset+=4,a;case 203:return a=this._view.getFloat64(this._offset),this._offset+=8,a;case 204:return a=this._view.getUint8(this._offset),this._offset+=1,a;case 205:return a=this._view.getUint16(this._offset),this._offset+=2,a;case 206:return a=this._view.getUint32(this._offset),this._offset+=4,a;case 207:return h=this._view.getUint32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,h+d;case 208:return a=this._view.getInt8(this._offset),this._offset+=1,a;case 209:return a=this._view.getInt16(this._offset),this._offset+=2,a;case 210:return a=this._view.getInt32(this._offset),this._offset+=4,a;case 211:return h=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,h+d;case 212:if(c=this._view.getInt8(this._offset),this._offset+=1,c===0){this._offset+=1;return}return[c,this._bin(1)];case 213:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(2)];case 214:return c=this._view.getInt8(this._offset),this._offset+=1,c===-1?(a=this._view.getUint32(this._offset),this._offset+=4,new Date(a*1e3)):[c,this._bin(4)];case 215:if(c=this._view.getInt8(this._offset),this._offset+=1,c===0)return h=this._view.getInt32(this._offset)*Math.pow(2,32),d=this._view.getUint32(this._offset+4),this._offset+=8,new Date(h+d);if(c===-1){h=this._view.getUint32(this._offset),d=this._view.getUint32(this._offset+4),this._offset+=8;var _=(h&3)*4294967296+d;return new Date(_*1e3+(h>>>2)/1e6)}return[c,this._bin(8)];case 216:return c=this._view.getInt8(this._offset),this._offset+=1,[c,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")};function Yn(s,a=0){var i=new Ge(s,a),c=i._parse();if(i._offset!==s.byteLength)throw new Error(s.byteLength-i._offset+" trailing bytes");return c}qe.decode=Yn;var Xn=4294967296-1,Vn=17179869184-1;function Qn(s,a,i){for(var c=0,h=0,d=i.length;h<d;h++)c=i.charCodeAt(h),c<128?s.setUint8(a++,c):c<2048?(s.setUint8(a++,192|c>>6),s.setUint8(a++,128|c&63)):c<55296||c>=57344?(s.setUint8(a++,224|c>>12),s.setUint8(a++,128|c>>6&63),s.setUint8(a++,128|c&63)):(h++,c=65536+((c&1023)<<10|i.charCodeAt(h)&1023),s.setUint8(a++,240|c>>18),s.setUint8(a++,128|c>>12&63),s.setUint8(a++,128|c>>6&63),s.setUint8(a++,128|c&63))}function Zn(s){for(var a=0,i=0,c=0,h=s.length;c<h;c++)a=s.charCodeAt(c),a<128?i+=1:a<2048?i+=2:a<55296||a>=57344?i+=3:(c++,i+=4);return i}function ze(s,a,i){var c=typeof i,h=0,d=0,$=0,_=0,E=0,A=0;if(c==="string"){if(E=Zn(i),E<32)s.push(E|160),A=1;else if(E<256)s.push(217,E),A=2;else if(E<65536)s.push(218,E>>8,E),A=3;else if(E<4294967296)s.push(219,E>>24,E>>16,E>>8,E),A=5;else throw new Error("String too long");return a.push({_str:i,_length:E,_offset:s.length}),A+E}if(c==="number")return Math.floor(i)!==i||!isFinite(i)?(s.push(203),a.push({_float:i,_length:8,_offset:s.length}),9):i>=0?i<128?(s.push(i),1):i<256?(s.push(204,i),2):i<65536?(s.push(205,i>>8,i),3):i<4294967296?(s.push(206,i>>24,i>>16,i>>8,i),5):($=i/Math.pow(2,32)>>0,_=i>>>0,s.push(207,$>>24,$>>16,$>>8,$,_>>24,_>>16,_>>8,_),9):i>=-32?(s.push(i),1):i>=-128?(s.push(208,i),2):i>=-32768?(s.push(209,i>>8,i),3):i>=-2147483648?(s.push(210,i>>24,i>>16,i>>8,i),5):($=Math.floor(i/Math.pow(2,32)),_=i>>>0,s.push(211,$>>24,$>>16,$>>8,$,_>>24,_>>16,_>>8,_),9);if(c==="object"){if(i===null)return s.push(192),1;if(Array.isArray(i)){if(E=i.length,E<16)s.push(E|144),A=1;else if(E<65536)s.push(220,E>>8,E),A=3;else if(E<4294967296)s.push(221,E>>24,E>>16,E>>8,E),A=5;else throw new Error("Array too large");for(h=0;h<E;h++)A+=ze(s,a,i[h]);return A}if(i instanceof Date){var m=i.getTime(),C=Math.floor(m/1e3),N=(m-C*1e3)*1e6;return C>=0&&N>=0&&C<=Vn?N===0&&C<=Xn?(s.push(214,255,C>>24,C>>16,C>>8,C),6):($=C/4294967296,_=C&4294967295,s.push(215,255,N>>22,N>>14,N>>6,$,_>>24,_>>16,_>>8,_),10):($=Math.floor(C/4294967296),_=C>>>0,s.push(199,12,255,N>>24,N>>16,N>>8,N,$>>24,$>>16,$>>8,$,_>>24,_>>16,_>>8,_),15)}if(i instanceof ArrayBuffer){if(E=i.byteLength,E<256)s.push(196,E),A=2;else if(E<65536)s.push(197,E>>8,E),A=3;else if(E<4294967296)s.push(198,E>>24,E>>16,E>>8,E),A=5;else throw new Error("Buffer too large");return a.push({_bin:i,_length:E,_offset:s.length}),A+E}if(typeof i.toJSON=="function")return ze(s,a,i.toJSON());var J=[],W="",M=Object.keys(i);for(h=0,d=M.length;h<d;h++)W=M[h],i[W]!==void 0&&typeof i[W]!="function"&&J.push(W);if(E=J.length,E<16)s.push(E|128),A=1;else if(E<65536)s.push(222,E>>8,E),A=3;else if(E<4294967296)s.push(223,E>>24,E>>16,E>>8,E),A=5;else throw new Error("Object too large");for(h=0;h<E;h++)W=J[h],A+=ze(s,a,W),A+=ze(s,a,i[W]);return A}if(c==="boolean")return s.push(i?195:194),1;if(c==="undefined")return s.push(192),1;if(typeof i.toJSON=="function")return ze(s,a,i.toJSON());throw new Error("Could not encode")}function er(s){var a=[],i=[],c=ze(a,i,s),h=new ArrayBuffer(c),d=new DataView(h),$=0,_=0,E=-1;i.length>0&&(E=i[0]._offset);for(var A,m=0,C=0,N=0,J=a.length;N<J;N++)if(d.setUint8(_+N,a[N]),N+1===E){if(A=i[$],m=A._length,C=_+E,A._bin)for(var W=new Uint8Array(A._bin),M=0;M<m;M++)d.setUint8(C+M,W[M]);else A._str?Qn(d,C,A._str):A._float!==void 0&&d.setFloat64(C,A._float);$++,_+=m,i[$]&&(E=i[$]._offset)}return h}qe.encode=er;var _t={},At={},tr=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},nr=G&&G.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(At,"__esModule",{value:!0});At.WebSocketTransport=void 0;const rr=nr(tr),vn=globalThis.WebSocket||rr.default;class ir{constructor(a){this.events=a}send(a){a instanceof ArrayBuffer?this.ws.send(a):Array.isArray(a)&&this.ws.send(new Uint8Array(a).buffer)}connect(a){this.ws=new vn(a,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(a,i){this.ws.close(a,i)}get isOpen(){return this.ws.readyState===vn.OPEN}}At.WebSocketTransport=ir;Object.defineProperty(_t,"__esModule",{value:!0});_t.Connection=void 0;const or=At;class sr{constructor(){this.events={},this.transport=new or.WebSocketTransport(this.events)}send(a){this.transport.send(a)}connect(a){this.transport.connect(a)}close(a,i){this.transport.close(a,i)}get isOpen(){return this.transport.isOpen}}_t.Connection=sr;var un={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.utf8Length=s.utf8Read=s.ErrorCode=s.Protocol=void 0,function(c){c[c.HANDSHAKE=9]="HANDSHAKE",c[c.JOIN_ROOM=10]="JOIN_ROOM",c[c.ERROR=11]="ERROR",c[c.LEAVE_ROOM=12]="LEAVE_ROOM",c[c.ROOM_DATA=13]="ROOM_DATA",c[c.ROOM_STATE=14]="ROOM_STATE",c[c.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",c[c.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",c[c.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(s.Protocol||(s.Protocol={})),function(c){c[c.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",c[c.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",c[c.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",c[c.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",c[c.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",c[c.AUTH_FAILED=4215]="AUTH_FAILED",c[c.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(s.ErrorCode||(s.ErrorCode={}));function a(c,h){const d=c[h++];for(var $="",_=0,E=h,A=h+d;E<A;E++){var m=c[E];if(!(m&128)){$+=String.fromCharCode(m);continue}if((m&224)===192){$+=String.fromCharCode((m&31)<<6|c[++E]&63);continue}if((m&240)===224){$+=String.fromCharCode((m&15)<<12|(c[++E]&63)<<6|(c[++E]&63)<<0);continue}if((m&248)===240){_=(m&7)<<18|(c[++E]&63)<<12|(c[++E]&63)<<6|(c[++E]&63)<<0,_>=65536?(_-=65536,$+=String.fromCharCode((_>>>10)+55296,(_&1023)+56320)):$+=String.fromCharCode(_);continue}throw new Error("Invalid byte "+m.toString(16))}return $}s.utf8Read=a;function i(c=""){let h=0,d=0;for(let $=0,_=c.length;$<_;$++)h=c.charCodeAt($),h<128?d+=1:h<2048?d+=2:h<55296||h>=57344?d+=3:($++,d+=4);return d+1}s.utf8Length=i})(un);var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.getSerializer=Ue.registerSerializer=void 0;const Sn={};function ar(s,a){Sn[s]=a}Ue.registerSerializer=ar;function cr(s){const a=Sn[s];if(!a)throw new Error("missing serializer: "+s);return a}Ue.getSerializer=cr;var Ot={};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.createNanoEvents=void 0;const fr=()=>({emit(s,...a){let i=this.events[s]||[];for(let c=0,h=i.length;c<h;c++)i[c](...a)},events:{},on(s,a){var i;return!((i=this.events[s])===null||i===void 0)&&i.push(a)||(this.events[s]=[a]),()=>{var c;this.events[s]=(c=this.events[s])===null||c===void 0?void 0:c.filter(h=>a!==h)}}});Ot.createNanoEvents=fr;var We={};Object.defineProperty(We,"__esModule",{value:!0});We.createSignal=We.EventEmitter=void 0;class Pn{constructor(){this.handlers=[]}register(a,i=!1){return this.handlers.push(a),this}invoke(...a){this.handlers.forEach(i=>i.apply(this,a))}invokeAsync(...a){return Promise.all(this.handlers.map(i=>i.apply(this,a)))}remove(a){const i=this.handlers.indexOf(a);this.handlers[i]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}We.EventEmitter=Pn;function hr(){const s=new Pn;function a(i){return s.register(i,this===null)}return a.once=i=>{const c=function(...h){i.apply(this,h),s.remove(c)};s.register(c)},a.remove=i=>s.remove(i),a.invoke=(...i)=>s.invoke(...i),a.invokeAsync=(...i)=>s.invokeAsync(...i),a.clear=()=>s.clear(),a}We.createSignal=hr;var cn={exports:{}};(function(s,a){(function(i,c){c(a)})(G,function(i){var c=function(t,e){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])},c(t,e)};function h(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");c(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function d(t,e,n,r){var o=arguments.length,f=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(t,e,n,r);else for(var y=t.length-1;y>=0;y--)(u=t[y])&&(f=(o<3?u(f):o>3?u(e,n,f):u(e,n))||f);return o>3&&f&&Object.defineProperty(e,n,f),f}function $(t,e,n){if(n||arguments.length===2)for(var r=0,o=e.length,f;r<o;r++)(f||!(r in e))&&(f||(f=Array.prototype.slice.call(e,0,r)),f[r]=e[r]);return t.concat(f||Array.prototype.slice.call(e))}var _=255,E=213;i.OPERATION=void 0,function(t){t[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR"}(i.OPERATION||(i.OPERATION={}));var A=function(){function t(e,n,r){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(n,r)}return t.prototype.setParent=function(e,n,r){var o=this;if(this.indexes||(this.indexes=this.ref instanceof q?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=r,!!n)if(this.root=n,this.ref instanceof q){var f=this.ref._definition;for(var u in f.schema){var y=this.ref[u];if(y&&y.$changes){var T=f.indexes[u];y.$changes.setParent(this.ref,n,T)}}}else typeof this.ref=="object"&&this.ref.forEach(function(O,p){if(O instanceof q){var S=O.$changes,g=o.ref.$changes.indexes[p];S.setParent(o.ref,o.root,g)}})},t.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},t.prototype.change=function(e,n){n===void 0&&(n=i.OPERATION.ADD);var r=typeof e=="number"?e:this.indexes[e];this.assertValidIndex(r,e);var o=this.changes.get(r);(!o||o.op===i.OPERATION.DELETE||o.op===i.OPERATION.TOUCH)&&this.changes.set(r,{op:o&&o.op===i.OPERATION.DELETE?i.OPERATION.DELETE_AND_ADD:n,index:r}),this.allChanges.add(r),this.changed=!0,this.touchParents()},t.prototype.touch=function(e){var n=typeof e=="number"?e:this.indexes[e];this.assertValidIndex(n,e),this.changes.has(n)||this.changes.set(n,{op:i.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(e){if(this.ref._definition){var n=this.ref._definition;return n.schema[n.fieldsByIndex[e]]}else{var n=this.parent._definition,r=n.schema[n.fieldsByIndex[this.parentIndex]];return Object.values(r)[0]}},t.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},t.prototype.getValue=function(e){return this.ref.getByIndex(e)},t.prototype.delete=function(e){var n=typeof e=="number"?e:this.indexes[e];if(n===void 0){console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(e," (").concat(n,")"));return}var r=this.getValue(n);this.changes.set(n,{op:i.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],r&&r.$changes&&(r.$changes.parent=void 0),this.changed=!0,this.touchParents()},t.prototype.discard=function(e,n){var r=this;e===void 0&&(e=!1),n===void 0&&(n=!1),this.ref instanceof q||this.changes.forEach(function(o){if(o.op===i.OPERATION.DELETE){var f=r.ref.getIndex(o.index);delete r.indexes[f]}}),this.changes.clear(),this.changed=e,n&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var e=this;this.changes.forEach(function(n){var r=e.getValue(n.index);r&&r.$changes&&r.$changes.discardAll()}),this.discard()},t.prototype.cache=function(e,n){this.caches[e]=n},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(e,n){if(e===void 0)throw new Error('ChangeTree: missing index for field "'.concat(n,'"'))},t}();function m(t,e,n,r){return t[e]||(t[e]=[]),t[e].push(n),r==null||r.forEach(function(o,f){return n(o,f)}),function(){return N(t[e],t[e].indexOf(n))}}function C(t){var e=this,n=typeof this.$changes.getType()!="string";this.$items.forEach(function(r,o){t.push({refId:e.$changes.refId,op:i.OPERATION.DELETE,field:o,value:void 0,previousValue:r}),n&&e.$changes.root.removeRef(r.$changes.refId)})}function N(t,e){if(e===-1||e>=t.length)return!1;for(var n=t.length-1,r=e;r<n;r++)t[r]=t[r+1];return t.length=n,!0}var J=function(t,e){var n=t.toString(),r=e.toString();return n<r?-1:n>r?1:0};function W(t){return t.$proxy=!0,t=new Proxy(t,{get:function(e,n){return typeof n!="symbol"&&!isNaN(n)?e.at(n):e[n]},set:function(e,n,r){if(typeof n!="symbol"&&!isNaN(n)){var o=Array.from(e.$items.keys()),f=parseInt(o[n]||n);r==null?e.deleteAt(f):e.setAt(f,r)}else e[n]=r;return!0},deleteProperty:function(e,n){return typeof n=="number"?e.deleteAt(n):delete e[n],!0}}),t}var M=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return t.prototype.onAdd=function(e,n){return n===void 0&&(n=!0),m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,e,n?this.$items:void 0)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.is=function(e){return Array.isArray(e)||e.array!==void 0},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(e){e===0?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o;return n.forEach(function(f){o=e.$refId++,e.setAt(o,f)}),o},t.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(e!==void 0){this.$changes.delete(e),this.$indexes.delete(e);var n=this.$items.get(e);return this.$items.delete(e),n}},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.setAt=function(e,n){var r,o;if(n==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.$items.get(e)!==n){n.$changes!==void 0&&n.$changes.setParent(this,this.$changes.root,e);var f=(o=(r=this.$changes.indexes[e])===null||r===void 0?void 0:r.op)!==null&&o!==void 0?o:i.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,n),this.$changes.change(e,f)}},t.prototype.deleteAt=function(e){var n=Array.from(this.$items.keys())[e];return n===void 0?!1:this.$deleteAt(n)},t.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&C.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new(t.bind.apply(t,$([void 0],(e=Array.from(this.$items.values())).concat.apply(e,n),!1)))},t.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},t.prototype.reverse=function(){var e=this,n=Array.from(this.$items.keys()),r=Array.from(this.$items.values()).reverse();return r.forEach(function(o,f){e.setAt(n[f],o)}),this},t.prototype.shift=function(){var e=Array.from(this.$items.keys()),n=e.shift();if(n!==void 0){var r=this.$items.get(n);return this.$deleteAt(n),r}},t.prototype.slice=function(e,n){var r=new t;return r.push.apply(r,Array.from(this.$items.values()).slice(e,n)),r},t.prototype.sort=function(e){var n=this;e===void 0&&(e=J);var r=Array.from(this.$items.keys()),o=Array.from(this.$items.values()).sort(e);return o.forEach(function(f,u){n.setAt(r[u],f)}),this},t.prototype.splice=function(e,n){n===void 0&&(n=this.length-e);for(var r=Array.from(this.$items.keys()),o=[],f=e;f<e+n;f++)o.push(this.$items.get(r[f])),this.$deleteAt(r[f]);return o},t.prototype.unshift=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=this.length,f=n.length,u=Array.from(this.$items.values());return n.forEach(function(y,T){e.setAt(T,y)}),u.forEach(function(y,T){e.setAt(f+T,y)}),o+f},t.prototype.indexOf=function(e,n){return Array.from(this.$items.values()).indexOf(e,n)},t.prototype.lastIndexOf=function(e,n){return n===void 0&&(n=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,n)},t.prototype.every=function(e,n){return Array.from(this.$items.values()).every(e,n)},t.prototype.some=function(e,n){return Array.from(this.$items.values()).some(e,n)},t.prototype.forEach=function(e,n){Array.from(this.$items.values()).forEach(e,n)},t.prototype.map=function(e,n){return Array.from(this.$items.values()).map(e,n)},t.prototype.filter=function(e,n){return Array.from(this.$items.values()).filter(e,n)},t.prototype.reduce=function(e,n){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},t.prototype.reduceRight=function(e,n){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},t.prototype.find=function(e,n){return Array.from(this.$items.values()).find(e,n)},t.prototype.findIndex=function(e,n){return Array.from(this.$items.values()).findIndex(e,n)},t.prototype.fill=function(e,n,r){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(e,n,r){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(e,n){return Array.from(this.$items.values()).includes(e,n)},t.prototype.flatMap=function(e,n){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.findLast=function(){var e=Array.from(this.$items.values());return e.findLast.apply(e,arguments)},t.prototype.findLastIndex=function(){var e=Array.from(this.$items.values());return e.findLastIndex.apply(e,arguments)},t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map(function(e){return typeof e.toJSON=="function"?e.toJSON():e})},t.prototype.clone=function(e){var n;return e?n=new(t.bind.apply(t,$([void 0],Array.from(this.$items.values()),!1))):n=new(t.bind.apply(t,$([void 0],this.map(function(r){return r.$changes?r.clone():r}),!1))),n},t}();function Ie(t){return t.$proxy=!0,t=new Proxy(t,{get:function(e,n){return typeof n!="symbol"&&typeof e[n]>"u"?e.get(n):e[n]},set:function(e,n,r){return typeof n!="symbol"&&n.indexOf("$")===-1&&n!=="onAdd"&&n!=="onRemove"&&n!=="onChange"?e.set(n,r):e[n]=r,!0},deleteProperty:function(e,n){return e.delete(n),!0}}),t}var B=function(){function t(e){var n=this;if(this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map||e instanceof t)e.forEach(function(o,f){return n.set(f,o)});else for(var r in e)this.set(r,e[r])}return t.prototype.onAdd=function(e,n){return n===void 0&&(n=!0),m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,e,n?this.$items:void 0)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.is=function(e){return e.map!==void 0},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.set=function(e,n){if(n==null)throw new Error("MapSchema#set('".concat(e,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(e,"'."));e=e.toString();var r=typeof this.$changes.indexes[e]<"u",o=r?this.$changes.indexes[e]:this.$refId++,f=r?i.OPERATION.REPLACE:i.OPERATION.ADD,u=n.$changes!==void 0;if(u&&n.$changes.setParent(this,this.$changes.root,o),!r)this.$changes.indexes[e]=o,this.$indexes.set(o,e);else{if(!u&&this.$items.get(e)===n)return;u&&this.$items.get(e)!==n&&(f=i.OPERATION.ADD)}return this.$items.set(e,n),this.$changes.change(e,f),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&C.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toJSON=function(){var e={};return this.forEach(function(n,r){e[r]=typeof n.toJSON=="function"?n.toJSON():n}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r,o){r.$changes?n.set(o,r.clone()):n.set(o,r)})),n},t}(),he={};function Y(t,e){he[t]=e}function ae(t){return he[t]}var Re=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(e){var n=new t;return n.schema=Object.assign({},e&&e.schema||{}),n.indexes=Object.assign({},e&&e.indexes||{}),n.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),n.descriptors=Object.assign({},e&&e.descriptors||{}),n.deprecated=Object.assign({},e&&e.deprecated||{}),n},t.prototype.addField=function(e,n){var r=this.getNextFieldIndex();this.fieldsByIndex[r]=e,this.indexes[e]=r,this.schema[e]=Array.isArray(n)?{array:n[0]}:n},t.prototype.hasField=function(e){return this.indexes[e]!==void 0},t.prototype.addFilter=function(e,n){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=n,this.indexesWithFilters.push(this.indexes[e]),!0},t.prototype.addChildrenFilter=function(e,n){var r=this.indexes[e],o=this.schema[e];if(ae(Object.keys(o)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[r]=n,!0;console.warn("@filterChildren: field '".concat(e,"' can't have children. Ignoring filter."))},t.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();function Tt(t){return t._context&&t._context.useFilters}var _e=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(e){return this.schemas.has(e)},t.prototype.get=function(e){return this.types[e]},t.prototype.add=function(e,n){n===void 0&&(n=this.schemas.size),e._definition=Re.create(e._definition),e._typeid=n,this.types[n]=e,this.schemas.set(e,n)},t.create=function(e){return e===void 0&&(e={}),function(n){return e.context||(e.context=new t),z(n,e)}},t}(),Xe=new _e;function z(t,e){return e===void 0&&(e={}),function(n,r){var o=e.context||Xe,f=n.constructor;if(f._context=o,!t)throw new Error("".concat(f.name,': @type() reference provided for "').concat(r,`" is undefined. Make sure you don't have any circular dependencies.`));o.has(f)||o.add(f);var u=f._definition;if(u.addField(r,t),u.descriptors[r]){if(u.deprecated[r])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(r,"' definition on '").concat(f.name,`'.
Check @type() annotation`))}catch(g){var y=g.stack.split(`
`)[4].trim();throw new Error("".concat(g.message," ").concat(y))}}var T=M.is(t),O=!T&&B.is(t);if(typeof t!="string"&&!q.is(t)){var p=Object.values(t)[0];typeof p!="string"&&!o.has(p)&&o.add(p)}if(e.manual){u.descriptors[r]={enumerable:!0,configurable:!0,writable:!0};return}var S="_".concat(r);u.descriptors[S]={enumerable:!1,configurable:!1,writable:!0},u.descriptors[r]={get:function(){return this[S]},set:function(g){g!==this[S]&&(g!=null?(T&&!(g instanceof M)&&(g=new(M.bind.apply(M,$([void 0],g,!1)))),O&&!(g instanceof B)&&(g=new B(g)),g.$proxy===void 0&&(O?g=Ie(g):T&&(g=W(g))),this.$changes.change(r),g.$changes&&g.$changes.setParent(this,this.$changes.root,this._definition.indexes[r])):this[S]&&this.$changes.delete(r),this[S]=g)},enumerable:!0,configurable:!0}}}function St(t){return function(e,n){var r=e.constructor,o=r._definition;o.addFilter(n,t)&&(r._context.useFilters=!0)}}function Pt(t){return function(e,n){var r=e.constructor,o=r._definition;o.addChildrenFilter(n,t)&&(r._context.useFilters=!0)}}function Ct(t){return t===void 0&&(t=!0),function(e,n){var r=e.constructor,o=r._definition;o.deprecated[n]=!0,t&&(o.descriptors[n]={get:function(){throw new Error("".concat(n," is deprecated."))},set:function(f){},enumerable:!1,configurable:!0})}}function Dt(t,e,n){n===void 0&&(n={}),n.context||(n.context=t._context||n.context||Xe);for(var r in e)z(e[r],n)(t.prototype,r);return t}function bt(t){for(var e=0,n=0,r=0,o=t.length;r<o;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function Ve(t,e,n){for(var r=0,o=0,f=n.length;o<f;o++)r=n.charCodeAt(o),r<128?t[e++]=r:r<2048?(t[e++]=192|r>>6,t[e++]=128|r&63):r<55296||r>=57344?(t[e++]=224|r>>12,t[e++]=128|r>>6&63,t[e++]=128|r&63):(o++,r=65536+((r&1023)<<10|n.charCodeAt(o)&1023),t[e++]=240|r>>18,t[e++]=128|r>>12&63,t[e++]=128|r>>6&63,t[e++]=128|r&63)}function Qe(t,e){t.push(e&255)}function j(t,e){t.push(e&255)}function Ze(t,e){t.push(e&255),t.push(e>>8&255)}function Te(t,e){t.push(e&255),t.push(e>>8&255)}function ue(t,e){t.push(e&255),t.push(e>>8&255),t.push(e>>16&255),t.push(e>>24&255)}function te(t,e){var n=e>>24,r=e>>16,o=e>>8,f=e;t.push(f&255),t.push(o&255),t.push(r&255),t.push(n&255)}function et(t,e){var n=Math.floor(e/Math.pow(2,32)),r=e>>>0;te(t,r),te(t,n)}function tt(t,e){var n=e/Math.pow(2,32)>>0,r=e>>>0;te(t,r),te(t,n)}function Nt(t,e){nt(t,e)}function kt(t,e){Se(t,e)}var de=new Int32Array(2),Mt=new Float32Array(de.buffer),Lt=new Float64Array(de.buffer);function nt(t,e){Mt[0]=e,ue(t,de[0])}function Se(t,e){Lt[0]=e,ue(t,de[0]),ue(t,de[1])}function jt(t,e){return j(t,e?1:0)}function Ae(t,e){e||(e="");var n=bt(e),r=0;if(n<32)t.push(n|160),r=1;else if(n<256)t.push(217),j(t,n),r=2;else if(n<65536)t.push(218),Te(t,n),r=3;else if(n<4294967296)t.push(219),te(t,n),r=5;else throw new Error("String too long");return Ve(t,t.length,e),r+n}function U(t,e){if(isNaN(e))return U(t,0);if(isFinite(e)){if(e!==(e|0))return t.push(203),Se(t,e),9}else return U(t,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER);return e>=0?e<128?(j(t,e),1):e<256?(t.push(204),j(t,e),2):e<65536?(t.push(205),Te(t,e),3):e<4294967296?(t.push(206),te(t,e),5):(t.push(207),tt(t,e),9):e>=-32?(t.push(224|e+32),1):e>=-128?(t.push(208),Qe(t,e),2):e>=-32768?(t.push(209),Ze(t,e),3):e>=-2147483648?(t.push(210),ue(t,e),5):(t.push(211),et(t,e),9)}var Pe=Object.freeze({__proto__:null,utf8Write:Ve,int8:Qe,uint8:j,int16:Ze,uint16:Te,int32:ue,uint32:te,int64:et,uint64:tt,float32:Nt,float64:kt,writeFloat32:nt,writeFloat64:Se,boolean:jt,string:Ae,number:U});function Ft(t,e,n){for(var r="",o=0,f=e,u=e+n;f<u;f++){var y=t[f];if(!(y&128)){r+=String.fromCharCode(y);continue}if((y&224)===192){r+=String.fromCharCode((y&31)<<6|t[++f]&63);continue}if((y&240)===224){r+=String.fromCharCode((y&15)<<12|(t[++f]&63)<<6|(t[++f]&63)<<0);continue}if((y&248)===240){o=(y&7)<<18|(t[++f]&63)<<12|(t[++f]&63)<<6|(t[++f]&63)<<0,o>=65536?(o-=65536,r+=String.fromCharCode((o>>>10)+55296,(o&1023)+56320)):r+=String.fromCharCode(o);continue}console.error("Invalid byte "+y.toString(16))}return r}function rt(t,e){return le(t,e)<<24>>24}function le(t,e){return t[e.offset++]}function it(t,e){return Oe(t,e)<<16>>16}function Oe(t,e){return t[e.offset++]|t[e.offset++]<<8}function ne(t,e){return t[e.offset++]|t[e.offset++]<<8|t[e.offset++]<<16|t[e.offset++]<<24}function ce(t,e){return ne(t,e)>>>0}function Ut(t,e){return Ce(t,e)}function zt(t,e){return De(t,e)}function ot(t,e){var n=ce(t,e),r=ne(t,e)*Math.pow(2,32);return r+n}function st(t,e){var n=ce(t,e),r=ce(t,e)*Math.pow(2,32);return r+n}var pe=new Int32Array(2),Bt=new Float32Array(pe.buffer),Ht=new Float64Array(pe.buffer);function Ce(t,e){return pe[0]=ne(t,e),Bt[0]}function De(t,e){return pe[0]=ne(t,e),pe[1]=ne(t,e),Ht[0]}function Jt(t,e){return le(t,e)>0}function at(t,e){var n=t[e.offset++],r;n<192?r=n&31:n===217?r=le(t,e):n===218?r=Oe(t,e):n===219&&(r=ce(t,e));var o=Ft(t,e.offset,r);return e.offset+=r,o}function qt(t,e){var n=t[e.offset];return n<192&&n>160||n===217||n===218||n===219}function re(t,e){var n=t[e.offset++];if(n<128)return n;if(n===202)return Ce(t,e);if(n===203)return De(t,e);if(n===204)return le(t,e);if(n===205)return Oe(t,e);if(n===206)return ce(t,e);if(n===207)return st(t,e);if(n===208)return rt(t,e);if(n===209)return it(t,e);if(n===210)return ne(t,e);if(n===211)return ot(t,e);if(n>223)return(255-n+1)*-1}function Wt(t,e){var n=t[e.offset];return n<128||n>=202&&n<=211}function Kt(t,e){return t[e.offset]<160}function ct(t,e){return t[e.offset-1]===_&&(t[e.offset]<128||t[e.offset]>=202&&t[e.offset]<=211)}var ft=Object.freeze({__proto__:null,int8:rt,uint8:le,int16:it,uint16:Oe,int32:ne,uint32:ce,float32:Ut,float64:zt,int64:ot,uint64:st,readFloat32:Ce,readFloat64:De,boolean:Jt,string:at,stringCheck:qt,number:re,numberCheck:Wt,arrayCheck:Kt,switchStructureCheck:ct}),be=function(){function t(e){var n=this;this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(r){return n.add(r)})}return t.prototype.onAdd=function(e,n){return n===void 0&&(n=!0),m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,e,n?this.$items:void 0)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.is=function(e){return e.collection!==void 0},t.prototype.add=function(e){var n=this.$refId++,r=e.$changes!==void 0;return r&&e.$changes.setParent(this,this.$changes.root,n),this.$changes.indexes[n]=n,this.$indexes.set(n,n),this.$items.set(n,e),this.$changes.change(n),n},t.prototype.at=function(e){var n=Array.from(this.$items.keys())[e];return this.$items.get(n)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var n=this.$items.entries(),r,o;(o=n.next())&&!o.done;)if(e===o.value[1]){r=o.value[0];break}return r===void 0?!1:(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},t.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&C.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return Array.from(this.$items.values()).some(function(n){return n===e})},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(r,o,f){return e(r,o,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,r){e.push(typeof n.toJSON=="function"?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r){r.$changes?n.add(r.clone()):n.add(r)})),n},t}(),Ne=function(){function t(e){var n=this;this.$changes=new A(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(r){return n.add(r)})}return t.prototype.onAdd=function(e,n){return n===void 0&&(n=!0),m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,e,n?this.$items:void 0)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.is=function(e){return e.set!==void 0},t.prototype.add=function(e){var n,r;if(this.has(e))return!1;var o=this.$refId++;e.$changes!==void 0&&e.$changes.setParent(this,this.$changes.root,o);var f=(r=(n=this.$changes.indexes[o])===null||n===void 0?void 0:n.op)!==null&&r!==void 0?r:i.OPERATION.ADD;return this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,e),this.$changes.change(o,f),o},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(e){for(var n=this.$items.entries(),r,o;(o=n.next())&&!o.done;)if(e===o.value[1]){r=o.value[0];break}return r===void 0?!1:(this.$changes.delete(r),this.$indexes.delete(r),this.$items.delete(r))},t.prototype.clear=function(e){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&C.call(this,e),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){for(var n=this.$items.values(),r=!1,o;(o=n.next())&&!o.done;)if(e===o.value){r=!0;break}return r},t.prototype.forEach=function(e){var n=this;this.$items.forEach(function(r,o,f){return e(r,o,n)})},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,n){this.$indexes.set(e,n)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var n=this.$indexes.get(e);this.$items.delete(n),this.$indexes.delete(e)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var e=[];return this.forEach(function(n,r){e.push(typeof n.toJSON=="function"?n.toJSON():n)}),e},t.prototype.clone=function(e){var n;return e?n=Object.assign(new t,this):(n=new t,this.forEach(function(r){r.$changes?n.add(r.clone()):n.add(r)})),n},t}(),Gt=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},t.get=function(e){return e.$filterState===void 0&&(e.$filterState=new t),e.$filterState},t}(),Yt=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(e,n,r){r===void 0&&(r=!0),this.refs.set(e,n),r&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},t.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach(function(n){if(!(e.refCounts[n]>0)){var r=e.refs.get(n);if(r instanceof q)for(var o in r._definition.schema)typeof r._definition.schema[o]!="string"&&r[o]&&r[o].$changes&&e.removeRef(r[o].$changes.refId);else{var f=r.$changes.parent._definition,u=f.schema[f.fieldsByIndex[r.$changes.parentIndex]];typeof Object.values(u)[0]=="function"&&Array.from(r.values()).forEach(function(y){return e.removeRef(y.$changes.refId)})}e.refs.delete(n),delete e.refCounts[n]}}),this.deletedRefs.clear()},t}(),ke=function(t){h(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Error);function Xt(t,e,n,r){var o,f=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":o="number",isNaN(t)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(r));break;case"string":o="string",f=!0;break;case"boolean":return}if(typeof t!==o&&(!f||f&&t!==null)){var u="'".concat(JSON.stringify(t),"'").concat(t&&t.constructor&&" (".concat(t.constructor.name,")")||"");throw new ke("a '".concat(o,"' was expected, but ").concat(u," was provided in ").concat(n.constructor.name,"#").concat(r))}}function ht(t,e,n,r){if(!(t instanceof e))throw new ke("a '".concat(e.name,"' was expected, but '").concat(t.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(r))}function Vt(t,e,n,r,o){Xt(n,t,r,o);var f=Pe[t];if(f)f(e,n);else throw new ke("a '".concat(t,"' was expected, but ").concat(n," was provided in ").concat(r.constructor.name,"#").concat(o))}function Qt(t,e,n){return ft[t](e,n)}var q=function(){function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Object.defineProperties(this,{$changes:{value:new A(this,void 0,new Yt),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var r=this._definition.descriptors;r&&Object.defineProperties(this,r),e[0]&&this.assign(e[0])}return t.onError=function(e){console.error(e)},t.is=function(e){return e._definition&&e._definition.schema!==void 0},t.prototype.onChange=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,e)},t.prototype.onRemove=function(e){return m(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,e)},t.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.setDirty=function(e,n){this.$changes.change(e,n)},t.prototype.listen=function(e,n,r){var o=this;return r===void 0&&(r=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[e]||(this.$callbacks[e]=[]),this.$callbacks[e].push(n),r&&this[e]!==void 0&&n(this[e],void 0),function(){return N(o.$callbacks[e],o.$callbacks[e].indexOf(n))}},t.prototype.decode=function(e,n,r){var o;n===void 0&&(n={offset:0}),r===void 0&&(r=this);var f=[],u=this.$changes.root,y=e.length,T=0;for(u.refs.set(T,this);n.offset<y;){var O=e[n.offset++];if(O==_){T=re(e,n);var p=u.refs.get(T);if(!p)throw new Error('"refId" not found: '.concat(T));r=p;continue}var S=r.$changes,g=r._definition!==void 0,w=g?O>>6<<6:O;if(w===i.OPERATION.CLEAR){r.clear(f);continue}var v=g?O%(w||255):re(e,n),x=g?r._definition.fieldsByIndex[v]:"",l=S.getType(v),I=void 0,D=void 0,b=void 0;if(g?D=r["_".concat(x)]:(D=r.getByIndex(v),(w&i.OPERATION.ADD)===i.OPERATION.ADD?(b=r instanceof B?at(e,n):v,r.setIndex(v,b)):b=r.getIndex(v)),(w&i.OPERATION.DELETE)===i.OPERATION.DELETE&&(w!==i.OPERATION.DELETE_AND_ADD&&r.deleteByIndex(v),D&&D.$changes&&u.removeRef(D.$changes.refId),I=null),x===void 0){console.warn("@colyseus/schema: definition mismatch");for(var P={offset:n.offset};n.offset<y&&!(ct(e,n)&&(P.offset=n.offset+1,u.refs.has(re(e,P))));)n.offset++;continue}else if(w!==i.OPERATION.DELETE)if(t.is(l)){var R=re(e,n);if(I=u.refs.get(R),w!==i.OPERATION.REPLACE){var V=this.getSchemaType(e,n,l);I||(I=this.createTypeInstance(V),I.$changes.refId=R,D&&(I.$callbacks=D.$callbacks,D.$changes.refId&&R!==D.$changes.refId&&u.removeRef(D.$changes.refId))),u.addRef(R,I,I!==D)}}else if(typeof l=="string")I=Qt(l,e,n);else{var je=ae(Object.keys(l)[0]),F=re(e,n),k=u.refs.has(F)?D||u.refs.get(F):new je.constructor;if(I=k.clone(!0),I.$changes.refId=F,D&&(I.$callbacks=D.$callbacks,D.$changes.refId&&F!==D.$changes.refId)){u.removeRef(D.$changes.refId);for(var L=D.entries(),ge=void 0;(ge=L.next())&&!ge.done;){var X=(o=ge.value,o[0]),Fe=o[1];f.push({refId:F,op:i.OPERATION.DELETE,field:X,value:void 0,previousValue:Fe})}}u.addRef(F,I,k!==D)}if(I!=null){if(I.$changes&&I.$changes.setParent(S.ref,S.root,v),r instanceof t)r[x]=I;else if(r instanceof B){var X=b;r.$items.set(X,I),r.$changes.allChanges.add(v)}else if(r instanceof M)r.setAt(v,I);else if(r instanceof be){var Q=r.add(I);r.setIndex(v,Q)}else if(r instanceof Ne){var Q=r.add(I);Q!==!1&&r.setIndex(v,Q)}}D!==I&&f.push({refId:T,op:w,field:x,dynamicIndex:b,value:I,previousValue:D})}return this._triggerChanges(f),u.garbageCollectDeletedRefs(),f},t.prototype.encode=function(e,n,r){e===void 0&&(e=!1),n===void 0&&(n=[]),r===void 0&&(r=!1);for(var o=this.$changes,f=new WeakSet,u=[o],y=1,T=0;T<y;T++){var O=u[T],p=O.ref,S=p instanceof t;O.ensureRefId(),f.add(O),O!==o&&(O.changed||e)&&(j(n,_),U(n,O.refId));for(var g=e?Array.from(O.allChanges):Array.from(O.changes.values()),w=0,v=g.length;w<v;w++){var x=e?{op:i.OPERATION.ADD,index:g[w]}:g[w],l=x.index,I=S?p._definition.fieldsByIndex&&p._definition.fieldsByIndex[l]:l,D=n.length;if(x.op!==i.OPERATION.TOUCH)if(S)j(n,l|x.op);else{if(j(n,x.op),x.op===i.OPERATION.CLEAR)continue;U(n,l)}if(!S&&(x.op&i.OPERATION.ADD)==i.OPERATION.ADD&&p instanceof B){var b=O.ref.$indexes.get(l);Ae(n,b)}if(x.op!==i.OPERATION.DELETE){var P=O.getType(l),R=O.getValue(l);if(R&&R.$changes&&!f.has(R.$changes)&&(u.push(R.$changes),R.$changes.ensureRefId(),y++),x.op!==i.OPERATION.TOUCH){if(t.is(P))ht(R,P,p,I),U(n,R.$changes.refId),(x.op&i.OPERATION.ADD)===i.OPERATION.ADD&&this.tryEncodeTypeId(n,P,R.constructor);else if(typeof P=="string")Vt(P,n,R,p,I);else{var V=ae(Object.keys(P)[0]);ht(p["_".concat(I)],V.constructor,p,I),U(n,R.$changes.refId)}r&&O.cache(l,n.slice(D))}}}!e&&!r&&O.discard()}return n},t.prototype.encodeAll=function(e){return this.encode(!0,[],e)},t.prototype.applyFilters=function(e,n){var r,o;n===void 0&&(n=!1);for(var f=this,u=new Set,y=Gt.get(e),T=[this.$changes],O=1,p=[],S=function(w){var v=T[w];if(u.has(v.refId))return"continue";var x=v.ref,l=x instanceof t;j(p,_),U(p,v.refId);var I=y.refIds.has(v),D=n||!I;y.addRefId(v);var b=y.containerIndexes.get(v),P=D?Array.from(v.allChanges):Array.from(v.changes.values());if(!n&&l&&x._definition.indexesWithFilters){var R=x._definition.indexesWithFilters;R.forEach(function(xe){!b.has(xe)&&v.allChanges.has(xe)&&(D?P.push(xe):P.push({op:i.OPERATION.ADD,index:xe}))})}for(var V=0,je=P.length;V<je;V++){var F=D?{op:i.OPERATION.ADD,index:P[V]}:P[V];if(F.op===i.OPERATION.CLEAR){j(p,F.op);continue}var k=F.index;if(F.op===i.OPERATION.DELETE){l?j(p,F.op|k):(j(p,F.op),U(p,k));continue}var L=v.getValue(k),ge=v.getType(k);if(l){var X=x._definition.filters&&x._definition.filters[k];if(X&&!X.call(x,e,L,f)){L&&L.$changes&&u.add(L.$changes.refId);continue}}else{var Fe=v.parent,X=v.getChildrenFilter();if(X&&!X.call(Fe,e,x.$indexes.get(k),L,f)){L&&L.$changes&&u.add(L.$changes.refId);continue}}if(L.$changes&&(T.push(L.$changes),O++),F.op!==i.OPERATION.TOUCH)if(F.op===i.OPERATION.ADD||l)p.push.apply(p,(r=v.caches[k])!==null&&r!==void 0?r:[]),b.add(k);else if(b.has(k))p.push.apply(p,(o=v.caches[k])!==null&&o!==void 0?o:[]);else{if(b.add(k),j(p,i.OPERATION.ADD),U(p,k),x instanceof B){var Q=v.ref.$indexes.get(k);Ae(p,Q)}L.$changes?U(p,L.$changes.refId):Pe[ge](p,L)}else if(L.$changes&&!l){if(j(p,i.OPERATION.ADD),U(p,k),x instanceof B){var Q=v.ref.$indexes.get(k);Ae(p,Q)}U(p,L.$changes.refId)}}},g=0;g<O;g++)S(g);return p},t.prototype.clone=function(){var e,n=new this.constructor,r=this._definition.schema;for(var o in r)typeof this[o]=="object"&&typeof((e=this[o])===null||e===void 0?void 0:e.clone)=="function"?n[o]=this[o].clone():n[o]=this[o];return n},t.prototype.toJSON=function(){var e=this._definition.schema,n=this._definition.deprecated,r={};for(var o in e)!n[o]&&this[o]!==null&&typeof this[o]<"u"&&(r[o]=typeof this[o].toJSON=="function"?this[o].toJSON():this["_".concat(o)]);return r},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},t.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},t.prototype.tryEncodeTypeId=function(e,n,r){n._typeid!==r._typeid&&(j(e,E),U(e,r._typeid))},t.prototype.getSchemaType=function(e,n,r){var o;return e[n.offset]===E&&(n.offset++,o=this.constructor._context.get(re(e,n))),o||r},t.prototype.createTypeInstance=function(e){var n=new e;return n.$changes.root=this.$changes.root,n},t.prototype._triggerChanges=function(e){for(var n,r,o,f,u,y,T,O,p,S=new Set,g=this.$changes.root.refs,w=function(x){var l=e[x],I=l.refId,D=g.get(I),b=D.$callbacks;if((l.op&i.OPERATION.DELETE)===i.OPERATION.DELETE&&l.previousValue instanceof t&&((r=(n=l.previousValue.$callbacks)===null||n===void 0?void 0:n[i.OPERATION.DELETE])===null||r===void 0||r.forEach(function(P){return P()})),!b)return"continue";if(D instanceof t){if(!S.has(I))try{(o=b==null?void 0:b[i.OPERATION.REPLACE])===null||o===void 0||o.forEach(function(P){return P()})}catch(P){t.onError(P)}try{b.hasOwnProperty(l.field)&&((f=b[l.field])===null||f===void 0||f.forEach(function(P){return P(l.value,l.previousValue)}))}catch(P){t.onError(P)}}else l.op===i.OPERATION.ADD&&l.previousValue===void 0?(u=b[i.OPERATION.ADD])===null||u===void 0||u.forEach(function(P){var R;return P(l.value,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)}):l.op===i.OPERATION.DELETE?l.previousValue!==void 0&&((y=b[i.OPERATION.DELETE])===null||y===void 0||y.forEach(function(P){var R;return P(l.previousValue,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)})):l.op===i.OPERATION.DELETE_AND_ADD&&(l.previousValue!==void 0&&((T=b[i.OPERATION.DELETE])===null||T===void 0||T.forEach(function(P){var R;return P(l.previousValue,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)})),(O=b[i.OPERATION.ADD])===null||O===void 0||O.forEach(function(P){var R;return P(l.value,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)})),l.value!==l.previousValue&&((p=b[i.OPERATION.REPLACE])===null||p===void 0||p.forEach(function(P){var R;return P(l.value,(R=l.dynamicIndex)!==null&&R!==void 0?R:l.field)}));S.add(I)},v=0;v<e.length;v++)w(v)},t._definition=Re.create(),t}();function Zt(t){for(var e=[t.$changes],n=1,r={},o=r,f=function(y){var T=e[y];T.changes.forEach(function(O){var p=T.ref,S=O.index,g=p._definition?p._definition.fieldsByIndex[S]:p.$indexes.get(S);o[g]=T.getValue(S)})},u=0;u<n;u++)f(u);return r}var ie={context:new _e},Me=function(t){h(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return d([z("string",ie)],e.prototype,"name",void 0),d([z("string",ie)],e.prototype,"type",void 0),d([z("number",ie)],e.prototype,"referencedType",void 0),e}(q),Le=function(t){h(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.fields=new M,n}return d([z("number",ie)],e.prototype,"id",void 0),d([z([Me],ie)],e.prototype,"fields",void 0),e}(q),en=function(t){h(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.types=new M,n}return e.encode=function(n){var r=n.constructor,o=new e;o.rootType=r._typeid;var f=function(O,p){for(var S in p){var g=new Me;g.name=S;var w=void 0;if(typeof p[S]=="string")w=p[S];else{var v=p[S],x=void 0;q.is(v)?(w="ref",x=p[S]):(w=Object.keys(v)[0],typeof v[w]=="string"?w+=":"+v[w]:x=v[w]),g.referencedType=x?x._typeid:-1}g.type=w,O.fields.push(g)}o.types.push(O)},u=r._context.types;for(var y in u){var T=new Le;T.id=Number(y),f(T,u[y]._definition.schema)}return o.encodeAll()},e.decode=function(n,r){var o=new _e,f=new e;f.decode(n,r);var u=f.types.reduce(function(S,g){var w=function(x){h(l,x);function l(){return x!==null&&x.apply(this,arguments)||this}return l}(q),v=g.id;return S[v]=w,o.add(w,v),S},{});f.types.forEach(function(S){var g=u[S.id];S.fields.forEach(function(w){var v;if(w.referencedType!==void 0){var x=w.type,l=u[w.referencedType];if(!l){var I=w.type.split(":");x=I[0],l=I[1]}x==="ref"?z(l,{context:o})(g.prototype,w.name):z((v={},v[x]=l,v),{context:o})(g.prototype,w.name)}else z(w.type,{context:o})(g.prototype,w.name)})});var y=u[f.rootType],T=new y;for(var O in y._definition.schema){var p=y._definition.schema[O];typeof p!="string"&&(T[O]=typeof p=="function"?new p:new(ae(Object.keys(p)[0])).constructor)}return T},d([z([Le],ie)],e.prototype,"types",void 0),d([z("number",ie)],e.prototype,"rootType",void 0),e}(q);Y("map",{constructor:B}),Y("array",{constructor:M}),Y("set",{constructor:Ne}),Y("collection",{constructor:be}),i.ArraySchema=M,i.CollectionSchema=be,i.Context=_e,i.MapSchema=B,i.Reflection=en,i.ReflectionField=Me,i.ReflectionType=Le,i.Schema=q,i.SchemaDefinition=Re,i.SetSchema=Ne,i.decode=ft,i.defineTypes=Dt,i.deprecated=Ct,i.dumpChanges=Zt,i.encode=Pe,i.filter=St,i.filterChildren=Pt,i.hasFilter=Tt,i.registerType=Y,i.type=z,Object.defineProperty(i,"__esModule",{value:!0})})})(cn,cn.exports);var Z=cn.exports,ur=G&&G.__createBinding||(Object.create?function(s,a,i,c){c===void 0&&(c=i);var h=Object.getOwnPropertyDescriptor(a,i);(!h||("get"in h?!a.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return a[i]}}),Object.defineProperty(s,c,h)}:function(s,a,i,c){c===void 0&&(c=i),s[c]=a[i]}),dr=G&&G.__setModuleDefault||(Object.create?function(s,a){Object.defineProperty(s,"default",{enumerable:!0,value:a})}:function(s,a){s.default=a}),lr=G&&G.__importStar||function(s){if(s&&s.__esModule)return s;var a={};if(s!=null)for(var i in s)i!=="default"&&Object.prototype.hasOwnProperty.call(s,i)&&ur(a,s,i);return dr(a,s),a};Object.defineProperty(pt,"__esModule",{value:!0});pt.Room=void 0;const yn=lr(qe),pr=_t,ee=un,mn=Ue,gr=Ot,vt=We,fe=Z,$n=hn;class dn{constructor(a,i){this.onStateChange=(0,vt.createSignal)(),this.onError=(0,vt.createSignal)(),this.onLeave=(0,vt.createSignal)(),this.onJoin=(0,vt.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,gr.createNanoEvents)(),this.roomId=null,this.name=a,i&&(this.serializer=new((0,mn.getSerializer)("schema")),this.rootSchema=i,this.serializer.state=new i),this.onError((c,h)=>console.warn(`colyseus.js - onError => (${c}) ${h}`)),this.onLeave(()=>this.removeAllListeners())}get id(){return this.roomId}connect(a,i,c=this){const h=new pr.Connection;c.connection=h,h.events.onmessage=dn.prototype.onMessageCallback.bind(c),h.events.onclose=function(d){if(!c.hasJoined){console.warn(`Room connection was closed unexpectedly (${d.code}): ${d.reason}`),c.onError.invoke(d.code,d.reason);return}d.code===$n.CloseCode.DEVMODE_RESTART&&i?i():(c.onLeave.invoke(d.code),c.destroy())},h.events.onerror=function(d){console.warn(`Room, onError (${d.code}): ${d.reason}`),c.onError.invoke(d.code,d.reason)},h.connect(a)}leave(a=!0){return new Promise(i=>{this.onLeave(c=>i(c)),this.connection?a?this.connection.send([ee.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke($n.CloseCode.CONSENTED)})}onMessage(a,i){return this.onMessageHandlers.on(this.getMessageHandlerKey(a),i)}send(a,i){const c=[ee.Protocol.ROOM_DATA];typeof a=="string"?fe.encode.string(c,a):fe.encode.number(c,a);let h;if(i!==void 0){const d=yn.encode(i);h=new Uint8Array(c.length+d.byteLength),h.set(new Uint8Array(c),0),h.set(new Uint8Array(d),c.length)}else h=new Uint8Array(c);this.connection.send(h.buffer)}sendBytes(a,i){const c=[ee.Protocol.ROOM_DATA_BYTES];typeof a=="string"?fe.encode.string(c,a):fe.encode.number(c,a);let h;h=new Uint8Array(c.length+(i.byteLength||i.length)),h.set(new Uint8Array(c),0),h.set(new Uint8Array(i),c.length),this.connection.send(h.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(a){const i=Array.from(new Uint8Array(a.data)),c=i[0];if(c===ee.Protocol.JOIN_ROOM){let h=1;const d=(0,ee.utf8Read)(i,h);if(h+=(0,ee.utf8Length)(d),this.serializerId=(0,ee.utf8Read)(i,h),h+=(0,ee.utf8Length)(this.serializerId),!this.serializer){const $=(0,mn.getSerializer)(this.serializerId);this.serializer=new $}i.length>h&&this.serializer.handshake&&this.serializer.handshake(i,{offset:h}),this.reconnectionToken=`${this.roomId}:${d}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([ee.Protocol.JOIN_ROOM])}else if(c===ee.Protocol.ERROR){const h={offset:1},d=fe.decode.number(i,h),$=fe.decode.string(i,h);this.onError.invoke(d,$)}else if(c===ee.Protocol.LEAVE_ROOM)this.leave();else if(c===ee.Protocol.ROOM_DATA_SCHEMA){const h={offset:1},$=this.serializer.getState().constructor._context.get(fe.decode.number(i,h)),_=new $;_.decode(i,h),this.dispatchMessage($,_)}else if(c===ee.Protocol.ROOM_STATE)i.shift(),this.setState(i);else if(c===ee.Protocol.ROOM_STATE_PATCH)i.shift(),this.patch(i);else if(c===ee.Protocol.ROOM_DATA){const h={offset:1},d=fe.decode.stringCheck(i,h)?fe.decode.string(i,h):fe.decode.number(i,h),$=i.length>h.offset?yn.decode(a.data,h.offset):void 0;this.dispatchMessage(d,$)}else if(c===ee.Protocol.ROOM_DATA_BYTES){const h={offset:1},d=fe.decode.stringCheck(i,h)?fe.decode.string(i,h):fe.decode.number(i,h);this.dispatchMessage(d,new Uint8Array(i.slice(h.offset)))}}setState(a){this.serializer.setState(a),this.onStateChange.invoke(this.serializer.getState())}patch(a){this.serializer.patch(a),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(a,i){const c=this.getMessageHandlerKey(a);this.onMessageHandlers.events[c]?this.onMessageHandlers.emit(c,i):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",a,i):console.warn(`colyseus.js: onMessage() not registered for type '${a}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(a){switch(typeof a){case"function":return`$${a._typeid}`;case"string":return a;case"number":return`i${a}`;default:throw new Error("invalid message type.")}}}pt.Room=dn;var Ee=G&&G.__awaiter||function(s,a,i,c){function h(d){return d instanceof i?d:new i(function($){$(d)})}return new(i||(i=Promise))(function(d,$){function _(m){try{A(c.next(m))}catch(C){$(C)}}function E(m){try{A(c.throw(m))}catch(C){$(C)}}function A(m){m.done?d(m.value):h(m.value).then(_,E)}A((c=c.apply(s,a||[])).next())})},tn;Object.defineProperty(Je,"__esModule",{value:!0});Je.Client=Je.MatchMakeError=void 0;const En=Tn,vr=hn,yr=pt;class xt extends Error{constructor(a,i){super(a),this.code=i,Object.setPrototypeOf(this,xt.prototype)}}Je.MatchMakeError=xt;const mr=typeof window<"u"&&typeof((tn=window==null?void 0:window.location)===null||tn===void 0?void 0:tn.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class $r{constructor(a=mr){if(typeof a=="string"){const i=new URL(a),c=i.protocol==="https:"||i.protocol==="wss:",h=Number(i.port||(c?443:80));this.settings={hostname:i.hostname,pathname:i.pathname!=="/"?i.pathname:"",port:h,secure:c}}else a.port===void 0&&(a.port=a.secure?443:80),a.pathname===void 0&&(a.pathname=""),this.settings=a}joinOrCreate(a,i={},c){return Ee(this,void 0,void 0,function*(){return yield this.createMatchMakeRequest("joinOrCreate",a,i,c)})}create(a,i={},c){return Ee(this,void 0,void 0,function*(){return yield this.createMatchMakeRequest("create",a,i,c)})}join(a,i={},c){return Ee(this,void 0,void 0,function*(){return yield this.createMatchMakeRequest("join",a,i,c)})}joinById(a,i={},c){return Ee(this,void 0,void 0,function*(){return yield this.createMatchMakeRequest("joinById",a,i,c)})}reconnect(a,i){return Ee(this,void 0,void 0,function*(){if(typeof a=="string"&&typeof i=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[c,h]=a.split(":");return yield this.createMatchMakeRequest("reconnect",c,{reconnectionToken:h},i)})}getAvailableRooms(a=""){return Ee(this,void 0,void 0,function*(){return(yield(0,En.get)(this.getHttpEndpoint(`${a}`),{headers:{Accept:"application/json"}})).data})}consumeSeatReservation(a,i,c){return Ee(this,void 0,void 0,function*(){const h=this.createRoom(a.room.name,i);h.roomId=a.room.roomId,h.sessionId=a.sessionId;const d={sessionId:h.sessionId};a.reconnectionToken&&(d.reconnectionToken=a.reconnectionToken);const $=c||h;return h.connect(this.buildEndpoint(a.room,d),a.devMode&&(()=>Ee(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${h.roomId}'...`);let _=0,E=8;const A=()=>Ee(this,void 0,void 0,function*(){_++;try{yield this.consumeSeatReservation(a,i,$),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${h.roomId}'`)}catch{_<E?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${_} out of ${E})`),setTimeout(A,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(A,2e3)})),$),new Promise((_,E)=>{const A=(m,C)=>E(new vr.ServerError(m,C));$.onError.once(A),$.onJoin.once(()=>{$.onError.remove(A),_($)})})})}createMatchMakeRequest(a,i,c={},h,d){return Ee(this,void 0,void 0,function*(){const $=(yield(0,En.post)(this.getHttpEndpoint(`${a}/${i}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(c)})).data;if($.error)throw new xt($.error,$.code);return a==="reconnect"&&($.reconnectionToken=c.reconnectionToken),yield this.consumeSeatReservation($,h,d)})}createRoom(a,i){return new yr.Room(a,i)}buildEndpoint(a,i={}){const c=[];for(const d in i)i.hasOwnProperty(d)&&c.push(`${d}=${i[d]}`);let h=this.settings.secure?"wss://":"ws://";return a.publicAddress?h+=`${a.publicAddress}`:h+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${h}/${a.processId}/${a.roomId}?${c.join("&")}`}getHttpEndpoint(a=""){return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${a}`}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}Je.Client=$r;var Cn={},we={};Object.defineProperty(we,"__esModule",{value:!0});we.getItem=we.removeItem=we.setItem=void 0;let nn;function ln(){return nn||(nn=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:{cache:{},setItem:function(s,a){this.cache[s]=a},getItem:function(s){this.cache[s]},removeItem:function(s){delete this.cache[s]}}),nn}function Er(s,a){ln().setItem(s,a)}we.setItem=Er;function _r(s){ln().removeItem(s)}we.removeItem=_r;function Ar(s,a){const i=ln().getItem(s);typeof Promise>"u"||!(i instanceof Promise)?a(i):i.then(c=>a(c))}we.getItem=Ar;(function(s){var a=G&&G.__createBinding||(Object.create?function(A,m,C,N){N===void 0&&(N=C);var J=Object.getOwnPropertyDescriptor(m,C);(!J||("get"in J?!m.__esModule:J.writable||J.configurable))&&(J={enumerable:!0,get:function(){return m[C]}}),Object.defineProperty(A,N,J)}:function(A,m,C,N){N===void 0&&(N=C),A[N]=m[C]}),i=G&&G.__setModuleDefault||(Object.create?function(A,m){Object.defineProperty(A,"default",{enumerable:!0,value:m})}:function(A,m){A.default=m}),c=G&&G.__importStar||function(A){if(A&&A.__esModule)return A;var m={};if(A!=null)for(var C in A)C!=="default"&&Object.prototype.hasOwnProperty.call(A,C)&&a(m,A,C);return i(m,A),m},h=G&&G.__awaiter||function(A,m,C,N){function J(W){return W instanceof C?W:new C(function(M){M(W)})}return new(C||(C=Promise))(function(W,M){function Ie(Y){try{he(N.next(Y))}catch(ae){M(ae)}}function B(Y){try{he(N.throw(Y))}catch(ae){M(ae)}}function he(Y){Y.done?W(Y.value):J(Y.value).then(Ie,B)}he((N=N.apply(A,m||[])).next())})};Object.defineProperty(s,"__esModule",{value:!0}),s.Auth=s.Platform=void 0;const d=c(Tn),$=we,_="colyseus-auth-token";(function(A){A.ios="ios",A.android="android"})(s.Platform||(s.Platform={}));class E{constructor(m){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=m.replace("ws","http"),(0,$.getItem)(_,C=>this.token=C)}get hasToken(){return!!this.token}login(m={}){return h(this,void 0,void 0,function*(){const C=Object.assign({},m);this.hasToken&&(C.token=this.token);const N=yield this.request("post","/auth",C);this.token=N.token,(0,$.setItem)(_,this.token);for(let J in N)this.hasOwnProperty(J)&&(this[J]=N[J]);return this.registerPingService(),this})}save(){return h(this,void 0,void 0,function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this})}getFriends(){return h(this,void 0,void 0,function*(){return yield this.request("get","/friends/all")})}getOnlineFriends(){return h(this,void 0,void 0,function*(){return yield this.request("get","/friends/online")})}getFriendRequests(){return h(this,void 0,void 0,function*(){return yield this.request("get","/friends/requests")})}sendFriendRequest(m){return h(this,void 0,void 0,function*(){return yield this.request("post","/friends/requests",{userId:m})})}acceptFriendRequest(m){return h(this,void 0,void 0,function*(){return yield this.request("put","/friends/requests",{userId:m})})}declineFriendRequest(m){return h(this,void 0,void 0,function*(){return yield this.request("del","/friends/requests",{userId:m})})}blockUser(m){return h(this,void 0,void 0,function*(){return yield this.request("post","/friends/block",{userId:m})})}unblockUser(m){return h(this,void 0,void 0,function*(){return yield this.request("put","/friends/block",{userId:m})})}request(m,C,N={},J,W={}){return h(this,void 0,void 0,function*(){W.Accept="application/json",this.hasToken&&(W.Authorization="Bearer "+this.token);const M=[];for(const he in N)M.push(`${he}=${N[he]}`);const Ie=M.length>0?`?${M.join("&")}`:"",B={headers:W};return J&&(B.body=J),(yield d[m](`${this.endpoint}${C}${Ie}`,B)).data})}logout(){this.token=void 0,(0,$.removeItem)(_),this.unregisterPingService()}registerPingService(m=15e3){this.unregisterPingService(),this.keepOnlineInterval=setInterval(()=>this.request("get","/auth"),m)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}s.Auth=E})(Cn);var wt={};Object.defineProperty(wt,"__esModule",{value:!0});wt.SchemaSerializer=void 0;const _n=Z;class Or{setState(a){return this.state.decode(a)}getState(){return this.state}patch(a){return this.state.decode(a)}teardown(){var a,i;(i=(a=this.state)===null||a===void 0?void 0:a.$changes)===null||i===void 0||i.root.clearRefs()}handshake(a,i){this.state?new _n.Reflection().decode(a,i):this.state=_n.Reflection.decode(a,i)}}wt.SchemaSerializer=Or;var It={};Object.defineProperty(It,"__esModule",{value:!0});It.NoneSerializer=void 0;class xr{setState(a){}getState(){return null}patch(a){}teardown(){}handshake(a){}}It.NoneSerializer=xr;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.SchemaSerializer=s.registerSerializer=s.Platform=s.Auth=s.Room=s.ErrorCode=s.Protocol=s.Client=void 0;var a=Je;Object.defineProperty(s,"Client",{enumerable:!0,get:function(){return a.Client}});var i=un;Object.defineProperty(s,"Protocol",{enumerable:!0,get:function(){return i.Protocol}}),Object.defineProperty(s,"ErrorCode",{enumerable:!0,get:function(){return i.ErrorCode}});var c=pt;Object.defineProperty(s,"Room",{enumerable:!0,get:function(){return c.Room}});var h=Cn;Object.defineProperty(s,"Auth",{enumerable:!0,get:function(){return h.Auth}}),Object.defineProperty(s,"Platform",{enumerable:!0,get:function(){return h.Platform}});const d=wt;Object.defineProperty(s,"SchemaSerializer",{enumerable:!0,get:function(){return d.SchemaSerializer}});const $=It,_=Ue;Object.defineProperty(s,"registerSerializer",{enumerable:!0,get:function(){return _.registerSerializer}}),(0,_.registerSerializer)("schema",d.SchemaSerializer),(0,_.registerSerializer)("none",$.NoneSerializer)})(zn);var wr=Object.defineProperty,Ir=Object.getOwnPropertyDescriptor,$e=(s,a,i,c)=>{for(var h=c>1?void 0:c?Ir(a,i):a,d=s.length-1,$;d>=0;d--)($=s[d])&&(h=(c?$(a,i,h):$(h))||h);return c&&h&&wr(a,i,h),h};const H={width:1280,height:720},He={x:Math.round(H.width/2),y:Math.round(H.height/2)};let fn="normal";In.subscribe(s=>{fn=s,console.log("Game schema [paddleSizeChoice] :",fn)});var ve;const pn=(ve=class extends Z.Schema{constructor(i,c){super();K(this,"x");K(this,"y",He.y);this.side=i,this.paddleSize=c,this.paddleSize=fn,this.initialize()}reset(){this.initialize()}initialize(){const i=ve.width/2+ve.offset;switch(this.side){case 0:this.x=i;break;case 1:this.x=H.width-i;break}this.y=He.y}},K(ve,"offset"),K(ve,"width"),K(ve,"height"),K(ve,"widthFactor"),K(ve,"heightFactor"),ve);$e([Z.type("int32")],pn.prototype,"x",2);$e([Z.type("int32")],pn.prototype,"y",2);let se=pn;class Ye extends Z.Schema{constructor(){super(...arguments);K(this,"x",He.x);K(this,"y",He.y)}reset(){this.center()}center(){this.x=He.x,this.y=He.y}}K(Ye,"radius",25);$e([Z.type("int32")],Ye.prototype,"x",2);$e([Z.type("int32")],Ye.prototype,"y",2);class Rt extends Z.Schema{constructor(){super(...arguments);K(this,"left",0);K(this,"right",0)}reset(){this.left=0,this.right=0}}$e([Z.type("int8")],Rt.prototype,"left",2);$e([Z.type("int8")],Rt.prototype,"right",2);var ut=(s=>(s[s.WAITING=0]="WAITING",s[s.PLAYING=1]="PLAYING",s[s.FINISHED=2]="FINISHED",s[s.INTERRUPTED=3]="INTERRUPTED",s))(ut||{});class gt extends Z.Schema{constructor(){super();K(this,"gameStatus",0);K(this,"scoreboard",new Rt);K(this,"leftPaddle",new se(0));K(this,"rightPaddle",new se(1));K(this,"ball",new Ye);K(this,"username","john");K(this,"scoreToWin");K(this,"userLoginToInvite");Nn.subscribe(i=>{this.username=i}),kn.subscribe(i=>{this.scoreToWin=i}),Rn.subscribe(i=>{this.userLoginToInvite=i})}}$e([Z.type("int8")],gt.prototype,"gameStatus",2);$e([Z.type(Rt)],gt.prototype,"scoreboard",2);$e([Z.type(se)],gt.prototype,"leftPaddle",2);$e([Z.type(se)],gt.prototype,"rightPaddle",2);$e([Z.type(Ye)],gt.prototype,"ball",2);const An={blue:"rgb(65, 135, 225)",orange:"rgb(255, 143, 31)",green:"rgb(0, 100, 0)",default:"rgb(0, 100, 0)"},On={blue:"green",orange:"white",green:"rgb(255, 95, 31)",default:"rgb(255, 95, 31)"};let mt;Mn.subscribe(s=>{mt=s,console.log("gameRender:",mt)});let $t;In.subscribe(s=>{$t=s,console.log("paddleSizeChoice :",$t)});function rn(s,a){s.fillText(a,H.width/2,H.height/2)}function Rr(s,a){s.beginPath(),s.setLineDash([2,4]),s.strokeStyle=a,s.moveTo(H.width/2,0),s.lineTo(H.width/2,H.height),s.stroke()}function Tr(s,a){s.beginPath(),s.setLineDash([2,4]),s.strokeStyle=a,s.moveTo(0,H.height/6),s.lineTo(H.width,H.height/6),s.stroke(),s.moveTo(0,H.height/6*5),s.lineTo(H.width,H.height/6*5),s.stroke()}function Sr(s,a){s.beginPath(),s.setLineDash([2,4]),s.strokeStyle=a,s.moveTo(H.width/10*9,H.height/6),s.lineTo(H.width/10*9,H.height/6*5),s.stroke(),s.moveTo(H.width/10,H.height/6),s.lineTo(H.width/10,H.height/6*5),s.stroke()}function Pr(s,a){s.beginPath(),s.arc(a.x,a.y,Ye.radius,0,2*Math.PI),s.closePath(),s.fill()}Rn.subscribe(s=>{});function xn(s,a){$t==="small"?(se.width=30,se.height=160):$t==="invisible"?(se.width=40,se.height=0):(se.width=40,se.height=200),s.fillRect(a.x-se.width/2,a.y-se.height/2,se.width,se.height)}function wn(s,a){s.fillText(a.left.toString(),H.width*(1/4),100),s.fillText(a.right.toString(),H.width*(3/4),100)}function jr(s,a){let i,c;switch(i=An[mt]||An.default,c=On[mt]||On.default,s.fillStyle=i,s.fillRect(0,0,H.width,H.height),s.fillStyle=c,s.lineWidth=8,s.font="bold 68px serif",s.textAlign="center",a.gameStatus){case ut.WAITING:rn(s,"Waiting an Opponent...");break;case ut.PLAYING:Rr(s,"white"),Tr(s,"white"),Sr(s,"white"),Pr(s,a.ball),xn(s,a.leftPaddle),xn(s,a.rightPaddle),wn(s,a.scoreboard);break;case ut.FINISHED:wn(s,a.scoreboard),rn(s,"Game Over");break;case ut.INTERRUPTED:rn(s,"Opponent left");break}}export{H as G,Un as P,Nr as a,jr as g,zn as l};
